import{r as g,s as i,j as e,L as R}from"./index-CbDMZEJu.js";const O={activeImports:0,doneImports:0,totalLines:0,pendingLines:0,partialLines:0,doneLines:0,openPallets:0,totalPallets:0,openContainers:0,closedContainers:0,dispatchedContainers:0,totalEvents:0,totalCamiones:0,totalSKUs:0,totalTiendas:0,totalUnits:0,totalConfirmed:0,totalPending:0,progressPercent:0};function M(t=1e4){const[l,a]=g.useState(O),[n,c]=g.useState(!0),[o,p]=g.useState(new Date),x=g.useCallback(async()=>{try{const[m,r,s,u,h,f,d,v,L,C,P,E,$,k,A,y]=await Promise.all([i.from("imports").select("id",{count:"exact",head:!0}).in("status",["DRAFT","IN_PROGRESS"]),i.from("imports").select("id",{count:"exact",head:!0}).eq("status","DONE"),i.from("import_lines").select("id",{count:"exact",head:!0}),i.from("import_lines").select("id",{count:"exact",head:!0}).eq("status","PENDING"),i.from("import_lines").select("id",{count:"exact",head:!0}).eq("status","PARTIAL"),i.from("import_lines").select("id",{count:"exact",head:!0}).eq("status","DONE"),i.from("pallets").select("id",{count:"exact",head:!0}).eq("status","OPEN"),i.from("pallets").select("id",{count:"exact",head:!0}),i.from("containers").select("id",{count:"exact",head:!0}).eq("status","OPEN"),i.from("containers").select("id",{count:"exact",head:!0}).eq("status","CLOSED"),i.from("containers").select("id",{count:"exact",head:!0}).eq("status","DISPATCHED"),i.from("scan_events").select("id",{count:"exact",head:!0}),i.from("import_lines").select("sku"),i.from("import_lines").select("tienda"),i.from("import_lines").select("camion"),i.from("import_lines").select("qty_ordered, qty_confirmed")]),j=s?.count??0,w=f?.count??0,q=j>0?Math.round(w/j*100):0,T=new Set($?.data?.map(b=>b.sku).filter(Boolean)??[]),I=new Set(k?.data?.map(b=>b.tienda).filter(Boolean)??[]),D=new Set(A?.data?.map(b=>b.camion).filter(Boolean)??[]),_=y?.data?.reduce((b,N)=>b+(N.qty_ordered||0),0)??0,S=y?.data?.reduce((b,N)=>b+(N.qty_confirmed||0),0)??0,U=_-S;a({activeImports:m?.count??0,doneImports:r?.count??0,totalLines:j,pendingLines:u?.count??0,partialLines:h?.count??0,doneLines:w,openPallets:d?.count??0,totalPallets:v?.count??0,openContainers:L?.count??0,closedContainers:C?.count??0,dispatchedContainers:P?.count??0,totalEvents:E?.count??0,totalCamiones:D.size,totalSKUs:T.size,totalTiendas:I.size,totalUnits:_,totalConfirmed:S,totalPending:U,progressPercent:q}),p(new Date)}catch(m){console.error("Error loading dashboard statistics:",m)}finally{c(!1)}},[]);return g.useEffect(()=>{x();const m=setInterval(x,t);return()=>clearInterval(m)},[x,t]),{stats:l,loading:n,lastUpdated:o,refresh:x}}function K(){const[t,l]=g.useState([]),[a,n]=g.useState(!0);g.useEffect(()=>{c();const o=setInterval(c,15e3);return()=>clearInterval(o)},[]);const c=async()=>{try{const{data:o,error:p}=await i.from("scan_events").select("id, event_type, raw_code, sku, tienda, qty, notes, created_at, pallet_id").order("created_at",{ascending:!1}).limit(8);if(p)throw p;if(o&&o.length>0){const x=o.filter(s=>s.pallet_id).map(s=>s.pallet_id);let m={};if(x.length>0){const{data:s}=await i.from("pallets").select("id, pallet_code").in("id",x);if(s&&s.length>0){const u=s.map(f=>f.pallet_code),{data:h}=await i.from("import_lines").select("pallet_code, camion").in("pallet_code",u);if(h){const f={};h.forEach(d=>{d.camion&&!f[d.pallet_code]&&(f[d.pallet_code]=d.camion)}),s.forEach(d=>{f[d.pallet_code]&&(m[d.id]=f[d.pallet_code])})}}}const r=o.map(s=>{const u=s.pallet_id&&m[s.pallet_id]||"",h=u?` [${u}]`:"",d={SCAN_PALLET:{desc:`Pallet escaneado: ${s.raw_code||"N/A"}`,icon:"ri-qr-scan-2-line",color:"bg-teal-100 text-teal-700"},SCAN_SKU:{desc:`SKU escaneado: ${s.sku||s.raw_code||"N/A"} → ${s.tienda||""}${h}`,icon:"ri-barcode-line",color:"bg-sky-100 text-sky-700"},CONFIRM_QTY:{desc:`Confirmado: ${s.qty} uds de ${s.sku||"N/A"} → ${s.tienda||""}${h}`,icon:"ri-check-double-line",color:"bg-emerald-100 text-emerald-700"},CLOSE:{desc:s.notes||`Distribución cerrada para ${s.tienda||"N/A"}${h}`,icon:"ri-inbox-archive-line",color:"bg-amber-100 text-amber-700"},UNLOCK:{desc:"Pallet liberado",icon:"ri-lock-unlock-line",color:"bg-gray-100 text-gray-700"},ADJUST:{desc:`Ajuste: ${s.notes||"N/A"}`,icon:"ri-edit-line",color:"bg-rose-100 text-rose-700"},REVERSE:{desc:`Reversión: ${s.qty} uds de ${s.sku||"N/A"} → ${s.tienda||""}${h}`,icon:"ri-arrow-go-back-line",color:"bg-rose-100 text-rose-700"}}[s.event_type]||{desc:s.event_type,icon:"ri-information-line",color:"bg-gray-100 text-gray-700"},v=z(new Date(s.created_at));return{id:s.id,type:s.event_type,description:d.desc,time:v,icon:d.icon,color:d.color}});l(r)}else l([])}catch(o){console.error("Error cargando actividad:",o)}finally{n(!1)}};return{activities:t,loading:a}}function z(t){const a=Math.floor((new Date().getTime()-t.getTime())/1e3);return a<60?"Hace un momento":a<3600?`Hace ${Math.floor(a/60)} min`:a<86400?`Hace ${Math.floor(a/3600)} h`:`Hace ${Math.floor(a/86400)} d`}function H(){const[t,l]=g.useState([]),[a,n]=g.useState(!0);g.useEffect(()=>{c();const o=setInterval(c,15e3);return()=>clearInterval(o)},[]);const c=async()=>{try{const{data:o}=await i.from("imports").select("id, status").neq("status","CANCELLED").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(!o){l([]),n(!1);return}const{data:p}=await i.from("import_lines").select("tienda, camion, qty_to_send, qty_confirmed").eq("import_id",o.id).not("tienda","is",null);if(!p||p.length===0){l([]),n(!1);return}const x=p.reduce((r,s)=>{const u=s.tienda;return r[u]||(r[u]={tienda:s.tienda,camion:s.camion||"Sin asignar",total:0,confirmed:0}),r[u].total+=s.qty_to_send||0,r[u].confirmed+=s.qty_confirmed||0,r},{}),m=Object.values(x).map(r=>({tienda:r.tienda,camion:r.camion,total:r.total,confirmed:r.confirmed,pending:r.total-r.confirmed,percent:r.total>0?Math.round(r.confirmed/r.total*100):0})).sort((r,s)=>s.percent-r.percent);l(m)}catch(o){console.error("Error cargando progreso por tienda:",o)}finally{n(!1)}};return{data:t,loading:a}}function G({stats:t,loading:l}){const a=[{title:"Total Pallets",value:t.totalPallets||0,icon:"ri-stack-line",color:"bg-teal-100 text-teal-700"},{title:"SKUs Únicos",value:t.totalSKUs||0,icon:"ri-barcode-line",color:"bg-sky-100 text-sky-700"},{title:"Tiendas",value:t.totalTiendas||0,icon:"ri-store-2-line",color:"bg-purple-100 text-purple-700"},{title:"Camiones",value:t.totalCamiones||0,icon:"ri-truck-line",color:"bg-amber-100 text-amber-700"},{title:"Unidades Totales",value:(t.totalUnits||0).toLocaleString(),icon:"ri-inbox-line",color:"bg-emerald-100 text-emerald-700"},{title:"Confirmadas",value:(t.totalConfirmed||0).toLocaleString(),icon:"ri-check-double-line",color:"bg-green-100 text-green-700"},{title:"Pendientes",value:(t.totalPending||0).toLocaleString(),icon:"ri-time-line",color:"bg-rose-100 text-rose-700"},{title:"Progreso",value:`${t.progressPercent||0}%`,icon:"ri-pie-chart-line",color:"bg-indigo-100 text-indigo-700"}];return l?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5",children:[1,2,3,4,5,6,7,8].map(n=>e.jsx("div",{className:"bg-white rounded-xl p-5 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 w-20 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded"})]})]})},n))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5",children:a.map((n,c)=>e.jsx("div",{className:"bg-white rounded-xl p-5 border border-gray-100 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 ${n.color} rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${n.icon} text-xl`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:n.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.value})]})]})},c))})}function B({stats:t}){if(!t)return console.error("ProgressOverview: `stats` prop is missing."),null;const l=[{label:"Completadas",value:t.doneLines??0,color:"bg-emerald-500"},{label:"Parciales",value:t.partialLines??0,color:"bg-amber-400"},{label:"Pendientes",value:t.pendingLines??0,color:"bg-gray-200"}],a=t.totalLines>0?t.totalLines:1;return e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Progreso General"}),e.jsxs("span",{className:"text-2xl font-bold text-teal-600",children:[t.progressPercent??0,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-gray-100 rounded-full overflow-hidden flex mb-4",children:l.map(n=>{const c=n.value/a*100;return c>0?e.jsx("div",{className:`${n.color} h-full transition-all duration-500`,style:{width:`${c}%`}},n.label):null})}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:l.map(n=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-1.5 mb-1",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${n.color}`}),e.jsx("span",{className:"text-xs text-gray-500",children:n.label})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n.value})]},n.label))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Total de líneas"}),e.jsx("span",{className:"font-semibold text-gray-900",children:t.totalLines??0})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"Cargas completadas"}),e.jsx("span",{className:"font-semibold text-gray-900",children:t.doneImports??0})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"Eventos de escaneo"}),e.jsx("span",{className:"font-semibold text-gray-900",children:t.totalEvents??0})]})]})]})}function F({activities:t=[],loading:l}){const a=Array.isArray(t)?t:[];return l?e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-100",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Actividad Reciente"}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(n=>e.jsxs("div",{className:"flex items-start space-x-3 animate-pulse",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 w-3/4 bg-gray-200 rounded mb-1"}),e.jsx("div",{className:"h-2 w-16 bg-gray-200 rounded"})]})]},n))})]}):e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Actividad Reciente"}),e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[11px] text-gray-400",children:"En vivo"})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ri-time-line text-3xl text-gray-300 mb-2"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Sin actividad reciente"})]}):e.jsx("div",{className:"space-y-3",children:a.map(n=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`w-8 h-8 min-w-[32px] rounded-lg flex items-center justify-center ${n.color}`,children:e.jsx("i",{className:`${n.icon} text-sm`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-700 leading-snug truncate",children:n.description}),e.jsx("p",{className:"text-[11px] text-gray-400 mt-0.5",children:n.time})]})]},n.id))})]})}function Q({data:t,loading:l}){return l?e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-100",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Progreso por Tienda"}),e.jsx("div",{className:"space-y-3 animate-pulse",children:[1,2,3].map(a=>e.jsx("div",{className:"h-10 bg-gray-100 rounded-lg"},a))})]}):e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-100",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Progreso por Tienda"}),t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ri-store-2-line text-3xl text-gray-300 mb-2"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Sin datos de tiendas"})]}):e.jsx("div",{className:"space-y-3",children:t.map(a=>e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("div",{className:"flex items-center space-x-2 truncate max-w-[60%]",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:a.tienda}),e.jsxs("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full whitespace-nowrap",children:[e.jsx("i",{className:"ri-truck-line mr-1"}),a.camion]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[a.confirmed,"/",a.total]}),e.jsxs("span",{className:`text-xs font-bold ${a.percent===100?"text-emerald-600":a.percent>50?"text-amber-600":"text-gray-500"}`,children:[a.percent,"%"]})]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${a.percent===100?"bg-emerald-500":a.percent>50?"bg-amber-400":"bg-teal-400"}`,style:{width:`${a.percent}%`}})})]},a.tienda))})]})}const V=[{title:"Importar Excel",desc:"Cargar nuevo archivo de pedidos",icon:"ri-file-excel-2-line",link:"/cargas/nueva",gradient:"from-emerald-500 to-emerald-600"},{title:"Escanear Pallet",desc:"Iniciar distribución de mercadería",icon:"ri-qr-scan-2-line",link:"/operacion",gradient:"from-teal-500 to-cyan-600"},{title:"Ver Cargas",desc:"Consultar importaciones activas",icon:"ri-file-list-3-line",link:"/cargas",gradient:"from-amber-500 to-orange-500"},{title:"Contenedores",desc:"Gestionar despachos",icon:"ri-inbox-line",link:"/contenedores",gradient:"from-rose-500 to-rose-600"}];function J(){return e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-100",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Acciones Rápidas"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:V.map(t=>e.jsxs(R,{to:t.link,className:"border border-gray-100 rounded-lg p-3 hover:border-teal-300 hover:shadow-sm transition-all cursor-pointer group",children:[e.jsx("div",{className:`w-9 h-9 bg-gradient-to-br ${t.gradient} rounded-lg flex items-center justify-center mb-2`,children:e.jsx("i",{className:`${t.icon} text-lg text-white`})}),e.jsx("p",{className:"text-sm font-medium text-gray-800 group-hover:text-teal-700 transition-colors leading-tight",children:t.title}),e.jsx("p",{className:"text-[11px] text-gray-400 mt-0.5 leading-tight",children:t.desc})]},t.title))})]})}function W(){const{stats:t,loading:l,lastUpdated:a,refresh:n}=M(1e4),{activities:c,loading:o}=K(),{data:p,loading:x}=H(),m=a instanceof Date?a:new Date;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Última actualización:"," ",m.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"})]})}),e.jsxs("button",{onClick:n,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-teal-700 bg-teal-50 rounded-lg hover:bg-teal-100 transition-colors cursor-pointer whitespace-nowrap",children:[e.jsx("i",{className:"ri-refresh-line"}),e.jsx("span",{children:"Actualizar"})]})]}),e.jsx(G,{stats:t,loading:l}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(B,{stats:t}),e.jsx(Q,{data:p,loading:x})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{}),e.jsx(F,{activities:c,loading:o})]})]})]})}export{W as default};
//# sourceMappingURL=page-Dbnuvyhn.js.map
