import{b as w,r as n,s as m,j as t,L as C}from"./index-CbDMZEJu.js";function P(){const{id:d}=w(),[i,p]=n.useState(null),[o,u]=n.useState([]),[g,f]=n.useState(!0),[s,l]=n.useState({pallet:"",sku:"",tienda:"",camion:"",status:"all"});n.useEffect(()=>{c();const e=setInterval(c,15e3);return()=>clearInterval(e)},[d]);const c=async()=>{try{const{data:e,error:r}=await m.from("imports").select("*").eq("id",d).single();if(r)throw r;p(e);const{data:a,error:x}=await m.from("import_lines").select("*").eq("import_id",d).order("created_at",{ascending:!0});if(x)throw x;u(a||[])}catch(e){console.error("Error cargando datos:",e)}finally{f(!1)}},h=o.filter(e=>!(s.pallet&&!e.pallet_code.toLowerCase().includes(s.pallet.toLowerCase())||s.sku&&!e.sku.toLowerCase().includes(s.sku.toLowerCase())||s.tienda&&!e.tienda.toLowerCase().includes(s.tienda.toLowerCase())||s.camion&&!e.camion.toLowerCase().includes(s.camion.toLowerCase())||s.status!=="all"&&e.status!==s.status)),y=o.reduce((e,r)=>(e[r.sku]||(e[r.sku]={sku:r.sku,descripcion:r.descripcion,total:0,confirmed:0}),e[r.sku].total+=r.qty_to_send,e[r.sku].confirmed+=r.qty_confirmed,e),{}),j=Object.values(y).map(e=>({...e,percentage:e.total>0?Math.round(e.confirmed/e.total*100):0,pending:e.total-e.confirmed})),N=o.reduce((e,r)=>{const a=r.camion||"Sin Camión";return e[a]||(e[a]={camion:a,total:0,confirmed:0}),e[a].total+=r.qty_to_send,e[a].confirmed+=r.qty_confirmed,e},{}),b=Object.values(N).map(e=>({...e,percentage:e.total>0?Math.round(e.confirmed/e.total*100):0,pending:e.total-e.confirmed})),v=e=>{const r={PENDING:"bg-amber-100 text-amber-700",PARTIAL:"bg-blue-100 text-blue-700",DONE:"bg-green-100 text-green-700"},a={PENDING:"Pendiente",PARTIAL:"Parcial",DONE:"Completado"};return t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r[e]}`,children:a[e]})};return g?t.jsx("div",{className:"flex items-center justify-center py-20",children:t.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-teal-500"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs(C,{to:"/cargas",className:"text-teal-600 hover:text-teal-700 text-sm font-medium mb-3 inline-flex items-center cursor-pointer",children:[t.jsx("i",{className:"ri-arrow-left-line mr-1"}),"Volver a Cargas"]}),t.jsx("h2",{className:"text-xl font-bold text-gray-900 mt-1",children:i?.file_name}),t.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[i?.completed_lines," / ",i?.total_lines," líneas completadas"]})]}),t.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 p-5",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Progreso por Camión"}),t.jsx("div",{className:"space-y-3",children:b.map(e=>t.jsxs("div",{className:"border border-gray-100 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{children:t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:e.camion})}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[e.confirmed," / ",e.total]}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Faltante: ",e.pending]})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex-1 bg-gray-100 rounded-full h-1.5",children:t.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-600 h-1.5 rounded-full transition-all",style:{width:`${e.percentage}%`}})}),t.jsxs("span",{className:"text-xs font-medium text-gray-700 w-10 text-right",children:[e.percentage,"%"]})]})]},e.camion))})]}),t.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 p-5",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Progreso por SKU"}),t.jsx("div",{className:"space-y-3",children:j.map(e=>t.jsxs("div",{className:"border border-gray-100 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:e.sku}),t.jsx("p",{className:"text-xs text-gray-500",children:e.descripcion})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[e.confirmed," / ",e.total]}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Faltante: ",e.pending]})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex-1 bg-gray-100 rounded-full h-1.5",children:t.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-cyan-600 h-1.5 rounded-full transition-all",style:{width:`${e.percentage}%`}})}),t.jsxs("span",{className:"text-xs font-medium text-gray-700 w-10 text-right",children:[e.percentage,"%"]})]})]},e.sku))})]}),t.jsxs("div",{className:"bg-white rounded-xl border border-gray-100",children:[t.jsx("div",{className:"p-4 border-b border-gray-100",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[t.jsx("input",{type:"text",placeholder:"Filtrar por Pallet",value:s.pallet,onChange:e=>l({...s,pallet:e.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"}),t.jsx("input",{type:"text",placeholder:"Filtrar por SKU",value:s.sku,onChange:e=>l({...s,sku:e.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"}),t.jsx("input",{type:"text",placeholder:"Filtrar por Tienda",value:s.tienda,onChange:e=>l({...s,tienda:e.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"}),t.jsx("input",{type:"text",placeholder:"Filtrar por Camión",value:s.camion,onChange:e=>l({...s,camion:e.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"}),t.jsxs("select",{value:s.status,onChange:e=>l({...s,status:e.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm cursor-pointer",children:[t.jsx("option",{value:"all",children:"Todos los estados"}),t.jsx("option",{value:"PENDING",children:"Pendiente"}),t.jsx("option",{value:"PARTIAL",children:"Parcial"}),t.jsx("option",{value:"DONE",children:"Completado"})]})]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pallet"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Descripción"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tienda"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Camión"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"A Enviar"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Confirmado"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:h.map(e=>t.jsxs("tr",{className:e.status==="DONE"?"bg-emerald-50/50":"",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.pallet_code}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.sku}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.descripcion}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.tienda}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.camion||"-"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.qty_to_send}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-teal-600",children:e.qty_confirmed}),t.jsx("td",{className:"px-4 py-3 text-sm",children:v(e.status)})]},e.id))})]})})]})]})}export{P as default};
//# sourceMappingURL=page-DuaaGQE4.js.map
