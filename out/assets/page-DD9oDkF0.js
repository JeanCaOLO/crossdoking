import{r as u,j as e,c as A,s as C}from"./index-CbDMZEJu.js";const I=[{value:"all",label:"Todos los tipos"},{value:"SCAN_PALLET",label:"Escaneo Pallet"},{value:"SCAN_SKU",label:"Escaneo SKU"},{value:"CONFIRM_QTY",label:"Confirmación"},{value:"REVERSE",label:"Reversión"},{value:"CLOSE",label:"Cierre"},{value:"UNLOCK",label:"Desbloqueo"},{value:"ADJUST",label:"Ajuste"}];function L({imports:x,onFilterChange:g}){const[l,n]=u.useState({importId:"all",eventType:"all",dateFrom:"",dateTo:"",searchTerm:""}),i=(t,c)=>{const v={...l,[t]:c};n(v),g(v)},d=()=>{const t={importId:"all",eventType:"all",dateFrom:"",dateTo:"",searchTerm:""};n(t),g(t)},s=l.importId!=="all"||l.eventType!=="all"||l.dateFrom!==""||l.dateTo!==""||l.searchTerm!=="";return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Filtros"}),s&&e.jsxs("button",{onClick:d,className:"text-xs text-teal-600 hover:text-teal-700 font-medium cursor-pointer whitespace-nowrap",children:[e.jsx("i",{className:"ri-filter-off-line mr-1"}),"Limpiar filtros"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"}),e.jsx("input",{type:"text",value:l.searchTerm,onChange:t=>i("searchTerm",t.target.value),placeholder:"SKU, tienda, notas...",className:"w-full pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5",children:"Tipo de Evento"}),e.jsx("select",{value:l.eventType,onChange:t=>i("eventType",t.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-transparent cursor-pointer",children:I.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5",children:"Importación"}),e.jsxs("select",{value:l.importId,onChange:t=>i("importId",t.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-transparent cursor-pointer",children:[e.jsx("option",{value:"all",children:"Todas"}),x.map(t=>e.jsx("option",{value:t.id,children:t.file_name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5",children:"Desde"}),e.jsx("input",{type:"date",value:l.dateFrom,onChange:t=>i("dateFrom",t.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-transparent cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5",children:"Hasta"}),e.jsx("input",{type:"date",value:l.dateTo,onChange:t=>i("dateTo",t.target.value),className:`w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-teal-5

            focus:border-transparent cursor-pointer`})]})]})]})}function D({totalMovimientos:x,totalConfirmaciones:g,totalReversiones:l,totalUnidades:n}){const i=t=>{const c=Number(t);return Number.isFinite(c)?c:0},d=[{label:"Total Movimientos",value:i(x),icon:"ri-exchange-line",gradient:"from-teal-50 to-cyan-50",border:"border-teal-200",iconBg:"bg-teal-100",iconColor:"text-teal-600",valueColor:"text-teal-700"},{label:"Confirmaciones",value:i(g),icon:"ri-checkbox-circle-line",gradient:"from-emerald-50 to-green-50",border:"border-emerald-200",iconBg:"bg-emerald-100",iconColor:"text-emerald-600",valueColor:"text-emerald-700"},{label:"Reversiones",value:i(l),icon:"ri-arrow-go-back-line",gradient:"from-amber-50 to-orange-50",border:"border-amber-200",iconBg:"bg-amber-100",iconColor:"text-amber-600",valueColor:"text-amber-700"},{label:"Unidades Movidas",value:i(n),icon:"ri-stack-line",gradient:"from-rose-50 to-pink-50",border:"border-rose-200",iconBg:"bg-rose-100",iconColor:"text-rose-600",valueColor:"text-rose-700"}],s=t=>{try{return t.toLocaleString()}catch{return String(t)}};return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:d.map(t=>e.jsx("div",{className:`bg-gradient-to-br ${t.gradient} border ${t.border} rounded-xl p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:t.label}),e.jsx("p",{className:`text-2xl font-bold ${t.valueColor} mt-1`,children:s(t.value)})]}),e.jsx("div",{className:`w-11 h-11 ${t.iconBg} rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${t.icon} text-xl ${t.iconColor}`})})]})},t.label))})}const O={SCAN_PALLET:{label:"Escaneo Pallet",bg:"bg-sky-100 text-sky-700",icon:"ri-qr-scan-2-line"},SCAN_SKU:{label:"Escaneo SKU",bg:"bg-indigo-100 text-indigo-700",icon:"ri-barcode-line"},CONFIRM_QTY:{label:"Confirmación",bg:"bg-emerald-100 text-emerald-700",icon:"ri-checkbox-circle-line"},REVERSE:{label:"Reversión",bg:"bg-amber-100 text-amber-700",icon:"ri-arrow-go-back-line"},CLOSE:{label:"Cierre",bg:"bg-rose-100 text-rose-700",icon:"ri-lock-line"},UNLOCK:{label:"Desbloqueo",bg:"bg-cyan-100 text-cyan-700",icon:"ri-lock-unlock-line"},ADJUST:{label:"Ajuste",bg:"bg-orange-100 text-orange-700",icon:"ri-settings-3-line"}};function V(x){return new Date(x).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function K({rows:x,loading:g,page:l,totalPages:n,onPageChange:i}){const d=Math.max(1,Math.min(l,n));return g?e.jsx("div",{className:"bg-white rounded-xl border border-gray-100 p-12",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-teal-500"})})}):x.length===0?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-50 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-file-list-3-line text-3xl text-gray-300"})}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"No se encontraron movimientos"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Ajusta los filtros para ver resultados"})]}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-5 py-4 border-b border-gray-100 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900",children:"Historial de Movimientos"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Página ",d," de ",n]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fecha / Hora"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Pallet"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tienda"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Camión"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Notas"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:x.map(s=>{const t=O[s.event_type]||{label:s.event_type,bg:"bg-gray-100 text-gray-700",icon:"ri-question-line"};return e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-xs text-gray-600",children:V(s.created_at)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${t.bg}`,children:[e.jsx("i",{className:`${t.icon} mr-1.5`}),t.label]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:s.pallet_code||"—"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.sku?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-sky-50 text-sky-700",children:s.sku}):e.jsx("span",{className:"text-xs text-gray-400",children:"\\u2014"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:s.tienda||"—"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:s.camion?e.jsxs("span",{className:"inline-flex items-center text-xs font-medium text-amber-700",children:[e.jsx("i",{className:"ri-truck-line mr-1"}),s.camion]}):e.jsx("span",{className:"text-xs text-gray-400",children:"\\u2014"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:s.qty!==null&&s.qty!==void 0?e.jsxs("span",{className:`text-sm font-semibold ${s.event_type==="REVERSE"?"text-amber-600":"text-teal-600"}`,children:[s.event_type==="REVERSE"?"-":"+",s.qty]}):e.jsx("span",{className:"text-xs text-gray-400",children:"\\u2014"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-xs text-gray-600",children:s.user_name||"—"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500 max-w-[200px] truncate",children:s.notes||"—"})]},s.id)})})]})}),n>1&&e.jsxs("div",{className:"px-5 py-3 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>i(d-1),disabled:d<=1,className:"px-3 py-1.5 text-sm font-medium text-gray-600 bg-gray-50 rounded-lg hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed transition-colors cursor-pointer whitespace-nowrap",children:[e.jsx("i",{className:"ri-arrow-left-s-line mr-1"}),"Anterior"]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(n,7)},(s,t)=>{let c;return n<=7||d<=4?c=t+1:d>=n-3?c=n-6+t:c=d-3+t,e.jsx("button",{onClick:()=>i(c),className:`w-8 h-8 rounded-lg text-xs font-medium transition-colors cursor-pointer ${c===d?"bg-teal-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:c},c)})}),e.jsxs("button",{onClick:()=>i(d+1),disabled:d>=n,className:"px-3 py-1.5 text-sm font-medium text-gray-600 bg-gray-50 rounded-lg hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed transition-colors cursor-pointer whitespace-nowrap",children:["Siguiente",e.jsx("i",{className:"ri-arrow-right-s-line ml-1"})]})]})]})}const w=25;function B(){const{showToast:x}=A(),[g,l]=u.useState([]),[n,i]=u.useState([]),[d,s]=u.useState(!0),[t,c]=u.useState(1),[v,T]=u.useState(0),[p,_]=u.useState({importId:"all",eventType:"all",dateFrom:"",dateTo:"",searchTerm:""}),[j,k]=u.useState({total:0,confirmaciones:0,reversiones:0,unidades:0});u.useEffect(()=>{S()},[]),u.useEffect(()=>{R(),E()},[t,p]);const S=async()=>{try{const{data:r}=await C.from("imports").select("id, file_name").order("created_at",{ascending:!1});l(r||[])}catch(r){console.error("Error cargando imports:",r)}},h=u.useCallback((r,b=!1)=>{let a=C.from("scan_events").select(r,b?{count:"exact",head:!0}:void 0);if(p.eventType!=="all"&&(a=a.eq("event_type",p.eventType)),p.dateFrom&&(a=a.gte("created_at",`${p.dateFrom}T00:00:00`)),p.dateTo&&(a=a.lte("created_at",`${p.dateTo}T23:59:59`)),p.searchTerm){const o=p.searchTerm.trim();a=a.or(`sku.ilike.%${o}%,tienda.ilike.%${o}%,notes.ilike.%${o}%,raw_code.ilike.%${o}%`)}return a},[p]),E=async()=>{try{const r=h("id",!0),{count:b}=await r,a=h("id",!0).eq("event_type","CONFIRM_QTY"),{count:o}=await a,f=h("id",!0).eq("event_type","REVERSE"),{count:y}=await f,{data:N}=await h("qty").in("event_type",["CONFIRM_QTY","REVERSE"]),m=(N||[]).reduce((q,U)=>q+(Number(U.qty)||0),0);k({total:b||0,confirmaciones:o||0,reversiones:y||0,unidades:m})}catch(r){console.error("Error cargando stats:",r)}},R=async()=>{s(!0);try{const r=h("id",!0),{count:b}=await r;T(b||0);const a=(t-1)*w,o=a+w-1,{data:f,error:y}=await h("id, pallet_id, event_type, raw_code, sku, tienda, qty, notes, user_id, created_at, pallets(pallet_code), users:user_id(full_name, email)").order("created_at",{ascending:!1}).range(a,o);if(y)throw y;const N=(f||[]).map(m=>({id:m.id,event_type:m.event_type,sku:m.sku,tienda:m.tienda,qty:m.qty,notes:m.notes,created_at:m.created_at,pallet_code:m.pallets?.pallet_code||"",user_name:m.users?.full_name||m.users?.email||""}));i(N)}catch(r){console.error("Error cargando movimientos:",r),x("error","Error","No se pudieron cargar los movimientos")}finally{s(!1)}},$=r=>{_(r),c(1)},F=Math.max(1,Math.ceil(v/w)),M=()=>{try{let r=`Fecha,Tipo,Pallet,SKU,Tienda,Cantidad,Usuario,Notas
`;n.forEach(o=>{const f=new Date(o.created_at).toLocaleString("es-ES"),y=(o.notes||"").replace(/"/g,'""');r+=`"${f}","${o.event_type}","${o.pallet_code}","${o.sku||""}","${o.tienda||""}",${o.qty||0},"${o.user_name}","${y}"
`});const b=new Blob([r],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(b),a.download=`movimientos_${new Date().toISOString().split("T")[0]}.csv`,a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),x("success","Exportado","Archivo CSV descargado")}catch(r){console.error("Error exportando CSV:",r),x("error","Error","No se pudo exportar")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reportes de Movimientos"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Historial completo de escaneos, confirmaciones y reversiones"})]}),e.jsxs("button",{onClick:M,disabled:n.length===0,className:"px-4 py-2.5 bg-teal-600 text-white rounded-lg text-sm font-medium hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Exportar CSV"]})]}),e.jsx(D,{totalMovimientos:j.total,totalConfirmaciones:j.confirmaciones,totalReversiones:j.reversiones,totalUnidades:j.unidades}),e.jsx(L,{imports:g,onFilterChange:$}),e.jsx(K,{rows:n,loading:d,page:t,totalPages:F,onPageChange:c})]})}export{B as default};
//# sourceMappingURL=page-DD9oDkF0.js.map
