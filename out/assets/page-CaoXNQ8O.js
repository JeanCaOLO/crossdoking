import{s as n,r,j as e,u as ne,c as ie,L as Te}from"./index-CbDMZEJu.js";async function Ie(){const{data:f}=await n.from("containers").select("code").like("code","22O%").order("code",{ascending:!1}).limit(1).maybeSingle();let p=1;return f?.code&&(p=parseInt(f.code.substring(3),10)+1),`22O${p.toString().padStart(8,"0")}`}async function Pe(i,f,p){let d=0;for(;d<3;)try{const{data:u}=await n.from("containers").select("id").eq("import_id",i).eq("tienda",f).eq("status","OPEN").maybeSingle();if(u)return u.id;const v=await Ie(),{data:x,error:b}=await n.from("containers").insert({code:v,import_id:i,tienda:f,status:"OPEN",created_by:p}).select("id").single();if(b){if(b.code==="23505"){d++;continue}throw b}return x.id}catch(u){if(d++,d>=3)throw new Error(`Error al crear contenedor después de 3 intentos: ${u}`);await new Promise(v=>setTimeout(v,100*d))}throw new Error("No se pudo crear el contenedor")}async function De(i){const{data:f}=await n.from("containers").select("status").eq("id",i).maybeSingle();return f?.status==="OPEN"}function Re({previousTienda:i,newTienda:f,sku:p,onClose:_}){const[d,u]=r.useState(!1);r.useEffect(()=>{requestAnimationFrame(()=>u(!0))},[]);const v=()=>{u(!1),setTimeout(_,250)};return e.jsx("div",{className:`fixed inset-0 z-[70] flex items-center justify-center p-4 transition-all duration-250 ${d?"bg-black/40":"bg-black/0"}`,onClick:v,children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-2xl max-w-sm w-full overflow-hidden transition-all duration-250 ${d?"scale-100 opacity-100":"scale-95 opacity-0"}`,onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"bg-gradient-to-r from-sky-500 to-cyan-500 px-6 py-5 text-center",children:[e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"ri-store-2-line text-3xl text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Cambio de Tienda"})]}),e.jsxs("div",{className:"px-6 py-5",children:[e.jsxs("p",{className:"text-sm text-gray-500 text-center mb-5",children:["El SKU ",e.jsx("span",{className:"font-semibold text-gray-800",children:p})," ahora se distribuye a otra tienda"]}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-5",children:[e.jsxs("div",{className:"flex-1 text-center bg-gray-50 rounded-xl py-3 px-2 border border-gray-100",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-gray-400 font-medium mb-1",children:"Anterior"}),e.jsx("p",{className:"text-sm font-bold text-gray-700",children:i})]}),e.jsx("div",{className:"w-8 h-8 flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:"ri-arrow-right-line text-xl text-sky-500"})}),e.jsxs("div",{className:"flex-1 text-center bg-sky-50 rounded-xl py-3 px-2 border border-sky-100",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-sky-400 font-medium mb-1",children:"Nueva"}),e.jsx("p",{className:"text-sm font-bold text-sky-700",children:f})]})]}),e.jsx("button",{onClick:v,className:"w-full py-3 bg-gradient-to-r from-sky-500 to-cyan-500 text-white rounded-xl font-medium text-sm hover:from-sky-600 hover:to-cyan-600 transition-all whitespace-nowrap cursor-pointer",children:"Entendido"})]})]})})}function Ae({pallet:i,importId:f,onClose:p,onComplete:_}){const{user:d}=ne(),{showToast:u}=ie(),[v,x]=r.useState(!0),[b,R]=r.useState(!1),[k,E]=r.useState([]),[h,$]=r.useState(""),[l,T]=r.useState("review");r.useEffect(()=>{A()},[]);const A=async()=>{x(!0);try{const{data:a}=await n.from("pallet_inventory").select("*").eq("pallet_id",i.id).gt("qty_available",0);if(!a||a.length===0){u("info","Sin sobrantes","No hay inventario disponible en este pallet"),p();return}const g=a.map(w=>({sku:w.sku,qty_available:w.qty_available,qty_sobrante:w.qty_available}));E(g)}catch{u("error","Error","No se pudo cargar el inventario restante"),p()}finally{x(!1)}},S=(a,g)=>{const w=parseFloat(g)||0;E(N=>N.map((D,M)=>M===a?{...D,qty_sobrante:Math.min(Math.max(0,w),D.qty_available)}:D))},c=k.reduce((a,g)=>a+g.qty_sobrante,0),m=k.some(a=>a.qty_sobrante>0),q=async()=>{const{data:g}=await n.from("containers").select("code").like("code","SOB%").order("code",{ascending:!1}).limit(1).maybeSingle();let w=1;return g?.code&&(w=parseInt(g.code.substring(3),10)+1),`SOB${w.toString().padStart(8,"0")}`},P=async()=>{if(!(!d||!m)){R(!0);try{const a=await q();$(a);const{data:g,error:w}=await n.from("containers").insert({code:a,import_id:f,tienda:"SOBRANTE",status:"CLOSED",type:"SOBRANTE",created_by:d.id,closed_at:new Date().toISOString()}).select("id").single();if(w)throw w;for(const N of k){if(N.qty_sobrante<=0)continue;const{error:D}=await n.from("container_lines").insert({container_id:g.id,pallet_id:i.id,sku:N.sku,qty:N.qty_sobrante,source_import_line_id:null});if(D)throw D;const{data:M}=await n.from("pallet_inventory").select("qty_available").eq("pallet_id",i.id).eq("sku",N.sku).maybeSingle();if(M){const U=Math.max(0,M.qty_available-N.qty_sobrante);await n.from("pallet_inventory").update({qty_available:U}).eq("pallet_id",i.id).eq("sku",N.sku)}await n.from("scan_events").insert({pallet_id:i.id,event_type:"ADJUST",sku:N.sku,tienda:"SOBRANTE",qty:N.qty_sobrante,notes:`Sobrante reportado en contenedor ${a}`,user_id:d.id})}for(const N of k)N.qty_sobrante<=0||await n.from("distribution_moves").insert({import_id:f,pallet_id:i.id,sku:N.sku,tienda:"SOBRANTE",qty:N.qty_sobrante,user_id:d.id,source_import_line_id:"00000000-0000-0000-0000-000000000000"});T("confirm"),u("success","Sobrante registrado",`Contenedor ${a} creado con ${c} unidades`)}catch(a){console.error("Error al reportar sobrante:",a),u("error","Error",a instanceof Error?a.message:"No se pudo registrar el sobrante")}finally{R(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end md:items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white w-full md:max-w-lg md:rounded-xl shadow-xl flex flex-col max-h-[90vh] rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 md:px-6 md:py-4 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-archive-2-line text-white text-lg"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base md:text-lg font-bold text-gray-900",children:"Reportar Sobrante"}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:i.pallet_code})]})]}),e.jsx("button",{onClick:l==="confirm"?_:p,className:"w-9 h-9 flex items-center justify-center rounded-lg text-gray-400 hover:bg-gray-100 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:v?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-3xl text-teal-500 mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cargando inventario..."})]}):l==="review"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3.5 flex items-start gap-2.5",children:[e.jsx("i",{className:"ri-information-line text-amber-600 text-lg flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-amber-800",children:"Mercadería sobrante detectada"}),e.jsx("p",{className:"text-xs text-amber-700 mt-0.5",children:"Estos SKUs tienen inventario disponible después de completar la distribución. Confirma las cantidades sobrantes para registrarlas en un contenedor de sobrantes."})]})]}),e.jsx("div",{className:"space-y-3",children:k.map((a,g)=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-bold text-gray-900 font-mono",children:a.sku}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Disponible en pallet: ",e.jsx("strong",{className:"text-amber-600",children:a.qty_available})," uds"]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-600 mb-1.5",children:"Cantidad sobrante"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>S(g,String(Math.max(0,a.qty_sobrante-1))),className:"w-11 h-11 flex items-center justify-center bg-white border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 active:bg-gray-100 cursor-pointer transition-colors",children:e.jsx("i",{className:"ri-subtract-line text-lg"})}),e.jsx("input",{type:"number",value:a.qty_sobrante||"",onChange:w=>S(g,w.target.value),className:"flex-1 px-3 py-2.5 border-2 border-gray-200 rounded-xl text-center text-xl font-bold text-gray-900 focus:ring-2 focus:ring-amber-500 focus:border-amber-500",min:"0",max:a.qty_available,step:"1",inputMode:"numeric"}),e.jsx("button",{onClick:()=>S(g,String(Math.min(a.qty_available,a.qty_sobrante+1))),className:"w-11 h-11 flex items-center justify-center bg-white border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 active:bg-gray-100 cursor-pointer transition-colors",children:e.jsx("i",{className:"ri-add-line text-lg"})})]}),e.jsxs("button",{onClick:()=>S(g,String(a.qty_available)),className:"mt-2 w-full py-1.5 text-xs font-medium text-amber-700 bg-amber-50 border border-amber-200 rounded-lg hover:bg-amber-100 transition-colors cursor-pointer",children:["Usar todo el disponible (",a.qty_available,")"]})]})]},a.sku))}),e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Total Sobrante"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[k.filter(a=>a.qty_sobrante>0).length," SKU(s)"]})]}),e.jsx("span",{className:"text-3xl font-bold text-amber-600",children:c})]})})]}):e.jsxs("div",{className:"flex flex-col items-center py-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center mb-5",children:e.jsx("i",{className:"ri-checkbox-circle-line text-4xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Sobrante Registrado"}),e.jsx("p",{className:"text-sm text-gray-500 text-center mb-6",children:"Se creó el contenedor de sobrantes exitosamente"}),e.jsxs("div",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Contenedor"}),e.jsx("span",{className:"text-sm font-bold text-gray-900 font-mono",children:h})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Tipo"}),e.jsx("span",{className:"px-2.5 py-0.5 bg-amber-100 text-amber-700 text-xs font-semibold rounded-full",children:"SOBRANTE"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total unidades"}),e.jsx("span",{className:"text-sm font-bold text-amber-600",children:c})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Detalle"}),k.filter(a=>a.qty_sobrante>0).map(a=>e.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[e.jsx("span",{className:"text-sm font-mono text-gray-700",children:a.sku}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[a.qty_sobrante," uds"]})]},a.sku))]})]})]})}),e.jsx("div",{className:"px-4 py-3 md:px-6 md:py-4 border-t border-gray-100 flex-shrink-0",children:l==="review"?e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:p,className:"flex-1 py-3.5 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors cursor-pointer text-sm whitespace-nowrap",children:"Cancelar"}),e.jsx("button",{onClick:P,disabled:!m||b,className:"flex-1 py-3.5 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-semibold hover:from-amber-600 hover:to-orange-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer text-sm flex items-center justify-center gap-2 whitespace-nowrap",children:b?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin"}),"Registrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-archive-2-line"}),"Registrar Sobrante"]})})]}):e.jsxs("button",{onClick:_,className:"w-full py-3.5 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-xl font-semibold hover:from-teal-600 hover:to-cyan-700 transition-all cursor-pointer text-sm flex items-center justify-center gap-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-check-line text-lg"}),"Finalizar"]})})]})})}function Le({pallet:i,inventory:f,pendingLines:p,onClose:_,onComplete:d}){const{user:u,loading:v}=ne(),{showToast:x}=ie(),[b,R]=r.useState("scan"),[k,E]=r.useState(""),[h,$]=r.useState(""),[l,T]=r.useState(null),[A,S]=r.useState(""),[c,m]=r.useState(""),[q,P]=r.useState(!1),[a,g]=r.useState(!1),[w,N]=r.useState([]),[D,M]=r.useState(""),[U,K]=r.useState(""),[J,le]=r.useState(!1),[je,oe]=r.useState([]),[Z,F]=r.useState(""),[ee,B]=r.useState(!1),[Y,de]=r.useState(null),[ce,me]=r.useState([]),[Ne,se]=r.useState([]),[te,xe]=r.useState(null),H=r.useRef(null),z=r.useRef(null),V=r.useRef(null),L=!v&&u!==null;r.useEffect(()=>{b==="scan"&&setTimeout(()=>z.current?.focus(),100)},[b]),r.useEffect(()=>{b==="confirm"&&setTimeout(()=>V.current?.focus(),150)},[b,Z]),r.useEffect(()=>{h&&b==="confirm"?ue():(de(null),me([]),se([]))},[h,b]),r.useEffect(()=>{(async()=>{if(p.length>0){M(p[0].import_id);return}const{data:s}=await n.from("import_lines").select("import_id").eq("pallet_code",i.pallet_code).limit(1).maybeSingle();s&&M(s.import_id)})()},[p,i.pallet_code]);const ue=async()=>{try{const{data:t}=await n.from("import_lines").select("*").eq("pallet_code",i.pallet_code).eq("sku",h).order("tienda",{ascending:!0});if(!t||t.length===0)return;se(t);const s=t.reduce((j,I)=>j+I.qty_to_send,0),o=t.reduce((j,I)=>j+I.qty_confirmed,0),y=s>0?Math.round(o/s*100):0;de({total:s,confirmed:o,percentage:y});const O=t.map(j=>({tienda:j.tienda,camion:j.camion||"",qty_to_send:j.qty_to_send,qty_confirmed:j.qty_confirmed,pending:j.qty_to_send-j.qty_confirmed,status:j.status,importLineId:j.id}));me(O)}catch(t){console.error("Error cargando progreso del SKU:",t)}},fe=async t=>{try{const{data:s}=await n.from("import_lines").select("*").eq("pallet_code",i.pallet_code).eq("sku",t).in("status",["PENDING","PARTIAL"]).order("tienda",{ascending:!0});return!s||s.length===0?null:s.find(o=>o.qty_confirmed<o.qty_to_send)||null}catch{return null}},ve=t=>{if(t.pending<=0){x("warning","Tienda completa",`${t.tienda} ya tiene todas las unidades confirmadas`);return}const s=Ne.find(y=>y.tienda===t.tienda);if(!s)return;const o=Z;F(t.tienda),T(s),B(!0),S(""),m(""),o&&o!==t.tienda&&x("info","Tienda cambiada",`Ahora distribuyendo a ${t.tienda}`),setTimeout(()=>V.current?.focus(),100)},we=async()=>{B(!1);const t=await fe(h);t&&(T(t),F(t.tienda),S(""),m(""),x("info","Modo automático",`Tienda activa: ${t.tienda}`),setTimeout(()=>V.current?.focus(),100))},pe=async t=>{t?.preventDefault();const s=k.trim();if(!s)return;m("");let o=s,y=f.find(C=>C.sku===s);if(!y){const{data:C}=await n.from("import_lines").select("sku").eq("barcode",s).eq("pallet_code",i.pallet_code).limit(1).maybeSingle();C&&(o=C.sku,y=f.find(X=>X.sku===o))}if(!y){m("SKU / código de barra no encontrado en este pallet"),E(""),z.current?.focus();return}const{data:O}=await n.from("pallet_inventory").select("*").eq("id",y.id).maybeSingle();if(!O||O.qty_available<=0){m("No hay cantidad disponible para este SKU en el pallet"),E(""),z.current?.focus();return}const{data:j}=await n.from("import_lines").select("*").eq("pallet_code",i.pallet_code).eq("sku",o).in("status",["PENDING","PARTIAL"]).order("tienda",{ascending:!0});if(!j||j.length===0){m("No hay pedidos pendientes para este SKU"),E(""),z.current?.focus();return}const I=j.find(C=>C.qty_confirmed<C.qty_to_send);if(!I){m("No hay pedidos pendientes para este SKU"),E(""),z.current?.focus();return}se(j),L&&await n.from("scan_events").insert({pallet_id:i.id,event_type:"SCAN_SKU",raw_code:s,sku:o,tienda:I.tienda,user_id:u.id}),H.current=I.tienda,$(o),T(I),F(I.tienda),B(!1),E(""),R("confirm")},re=async()=>{const{data:t}=await n.from("pallet_inventory").select("*").eq("pallet_id",i.id).gt("qty_available",0);return N(t??[]),t??[]};r.useEffect(()=>{b==="scan"&&!h&&re()},[b,h]);const ae=async t=>{if(t?.preventDefault(),!L){m("Sesión no cargada. Por favor, vuelve a iniciar sesión.");return}if(!l||!A)return;const s=parseFloat(A);if(s<=0){m("La cantidad debe ser mayor a 0");return}const o=l.qty_to_send-l.qty_confirmed;if(o<=0){m("Esta línea ya está completa");return}const{data:y}=await n.from("pallet_inventory").select("*").eq("pallet_id",i.id).eq("sku",h).maybeSingle();if(!y||s>y.qty_available){m("Cantidad mayor al disponible en pallet");return}if(s>o){m("Cantidad mayor al pendiente del pedido");return}try{const O=await Pe(l.import_id,l.tienda,u.id);if(!await De(O)){m("El contenedor de esta tienda ya está cerrado");return}const{error:I}=await n.from("pallet_inventory").update({qty_available:y.qty_available-s}).eq("id",y.id);if(I)throw I;const C=l.qty_confirmed+s,X=C>=l.qty_to_send?"DONE":"PARTIAL",{error:be}=await n.from("import_lines").update({qty_confirmed:C,status:X,...X==="DONE"?{done_at:new Date().toISOString(),done_by:u.id}:{}}).eq("id",l.id);if(be)throw be;const{error:he}=await n.from("container_lines").insert({container_id:O,pallet_id:i.id,sku:h,qty:s,source_import_line_id:l.id});if(he)throw he;const{error:ge}=await n.from("distribution_moves").insert({import_id:l.import_id,pallet_id:i.id,sku:h,tienda:l.tienda,qty:s,user_id:u.id,source_import_line_id:l.id});if(ge)throw ge;await n.from("scan_events").insert({pallet_id:i.id,event_type:"CONFIRM_QTY",sku:h,tienda:l.tienda,qty:s,user_id:u.id}),x("success","Confirmado",`${s} uds de ${h} → ${l.tienda}`),await ue();const Ce=C>=l.qty_to_send?0:l.qty_to_send-C;if(ee&&Ce>0){T({...l,qty_confirmed:C,status:X}),S(""),m(""),setTimeout(()=>V.current?.focus(),100);return}const G=await fe(h),{data:ye}=await n.from("pallet_inventory").select("*").eq("pallet_id",i.id).eq("sku",h).maybeSingle(),Ee=ye&&ye.qty_available>0;if(G&&Ee){const Q=H.current;Q&&Q!==G.tienda&&xe({prev:Q,next:G.tienda,sku:h}),H.current=G.tienda,T(G),F(G.tienda),B(!1),S(""),m(""),setTimeout(()=>V.current?.focus(),100)}else{R("scan"),$(""),T(null),F(""),B(!1),S(""),m(""),H.current=null;const Q=await re();(!Q||Q.length===0)&&(x("info","Pallet agotado","Todo el inventario ha sido distribuido"),d())}}catch(O){m(`Error al confirmar: ${O instanceof Error?O.message:"Error desconocido"}`)}},_e=async()=>{if(!L){x("error","Error de sesión","Vuelve a iniciar sesión.");return}const t=D||p[0]?.import_id;if(!t){x("error","Error","No se encontró el ID de importación");return}const{data:s}=await n.from("containers").select("tienda").eq("import_id",t).eq("status","OPEN");if(!s||s.length===0){x("warning","Sin contenedores","No hay contenedores abiertos para cerrar");return}const o=[...new Set(s.map(y=>y.tienda))];oe(o),o.length===1&&K(o[0]),P(!0)},ke=async()=>{if(!(!L||!U)){le(!0);try{const t=D||p[0]?.import_id;if(!t)throw new Error("No se encontró el ID de importación");const{data:s}=await n.from("containers").select("id, code").eq("import_id",t).eq("tienda",U).eq("status","OPEN").maybeSingle();if(!s){x("error","Sin contenedor","No hay contenedor abierto para esta tienda"),P(!1),K("");return}const{count:o}=await n.from("container_lines").select("id",{count:"exact"}).eq("container_id",s.id);if(!o||o===0){x("warning","Contenedor vacío","Confirma cantidades antes de cerrar"),P(!1),K("");return}const{error:y}=await n.from("containers").update({status:"CLOSED",closed_at:new Date().toISOString()}).eq("id",s.id);if(y)throw y;await n.from("scan_events").insert({pallet_id:i.id,event_type:"CLOSE",tienda:U,notes:`Contenedor ${s.code} cerrado con ${o} líneas`,user_id:u.id}),x("success",`Contenedor ${s.code} cerrado`,`Tienda: ${U} · ${o} líneas`,6e3),P(!1),K(""),d()}catch(t){x("error","Error al cerrar",t instanceof Error?t.message:"Error desconocido")}finally{le(!1)}}},Se=async()=>{const t=D||p[0]?.import_id;if(!t)return;const{data:s}=await n.from("containers").select("tienda").eq("import_id",t).eq("status","OPEN");if(s){const o=[...new Set(s.map(y=>y.tienda))];oe(o),o.length===1&&K(o[0])}},W=l?l.qty_to_send-l.qty_confirmed:0,qe=!L||!A||parseFloat(A)<=0||W<=0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end md:items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white w-full md:max-w-2xl md:rounded-xl shadow-xl flex flex-col max-h-[95vh] md:max-h-[90vh] rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 md:px-6 md:py-4 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base md:text-xl font-bold text-gray-900",children:"Distribución"}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:i.pallet_code})]}),e.jsx("button",{onClick:_,className:"w-9 h-9 flex items-center justify-center rounded-lg text-gray-400 hover:bg-gray-100 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:[!L&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4 flex items-start gap-2",children:[e.jsx("i",{className:"ri-error-warning-line text-red-500 text-lg mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-700",children:v?"Cargando sesión...":"Sesión no disponible. Vuelve a iniciar sesión."})]}),b==="scan"?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-2xl flex items-center justify-center mb-4",children:e.jsx("i",{className:"ri-barcode-line text-3xl text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Leer SKU / Código de Barra"}),e.jsx("p",{className:"text-sm text-gray-500 mb-5 text-center",children:"Escanea el producto con el handheld o ingrésalo manualmente"}),c&&e.jsxs("div",{className:"w-full bg-red-50 border border-red-200 text-red-700 px-3 py-2.5 rounded-lg text-sm mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"ri-error-warning-line flex-shrink-0"}),c]}),e.jsxs("form",{onSubmit:pe,className:"w-full space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none",children:e.jsx("i",{className:"ri-barcode-line text-gray-400 text-lg"})}),e.jsx("input",{ref:z,type:"text",value:k,onChange:t=>E(t.target.value),onKeyDown:t=>{t.key==="Enter"&&pe()},placeholder:"SKU o código de barra...",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,className:"w-full pl-10 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 text-base font-mono tracking-wider text-gray-900 placeholder-gray-400"})]}),e.jsxs("button",{type:"submit",disabled:!L||!k.trim(),className:"w-full py-4 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-xl font-semibold text-base hover:from-teal-600 hover:to-cyan-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 cursor-pointer",children:[e.jsx("i",{className:"ri-search-line text-lg"}),"Buscar SKU"]})]}),w.length>0&&e.jsxs("div",{className:"w-full mt-5 bg-amber-50 border border-amber-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start gap-2.5 mb-3",children:[e.jsx("i",{className:"ri-archive-2-line text-amber-600 text-lg flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-amber-800",children:"Inventario restante en pallet"}),e.jsx("p",{className:"text-xs text-amber-700 mt-0.5",children:"Si ya terminaste la distribución y sobra mercadería, puedes reportarla como sobrante."})]})]}),e.jsx("div",{className:"space-y-1.5 mb-3",children:w.map(t=>e.jsxs("div",{className:"flex items-center justify-between bg-white/60 rounded-lg px-3 py-2",children:[e.jsx("span",{className:"text-xs font-mono font-semibold text-gray-700",children:t.sku}),e.jsxs("span",{className:"text-sm font-bold text-amber-600",children:[t.qty_available," uds"]})]},t.id))}),e.jsxs("button",{onClick:()=>g(!0),disabled:!L,className:"w-full py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-semibold text-sm hover:from-amber-600 hover:to-orange-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-archive-2-line"}),"Reportar Sobrante"]})]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-4 text-center",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"El handheld enviará el código automáticamente al presionar Enter"]})]}):e.jsxs("div",{className:"space-y-4",children:[Y&&e.jsxs("div",{className:"bg-gradient-to-r from-teal-50 to-cyan-50 border border-teal-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 font-mono",children:h}),e.jsx("p",{className:"text-xs text-gray-500",children:"Progreso total del SKU"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-teal-600",children:[Y.percentage,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[Y.confirmed,"/",Y.total," uds"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-cyan-600 h-full rounded-full transition-all duration-500",style:{width:`${Y.percentage}%`}})})]}),e.jsxs("div",{className:"bg-sky-50 border border-sky-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Tienda Activa:"}),e.jsx("span",{className:"text-base font-bold text-sky-700",children:Z}),l?.camion&&e.jsxs("span",{className:"text-xs font-medium text-amber-600 bg-amber-100 px-2 py-0.5 rounded-full inline-flex items-center gap-1",children:[e.jsx("i",{className:"ri-truck-line"}),l.camion]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold ${ee?"bg-amber-100 text-amber-700":"bg-teal-100 text-teal-700"}`,children:ee?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-hand-coin-line mr-1"}),"Manual"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-robot-line mr-1"}),"Auto"]})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Pendiente:"}),e.jsxs("span",{className:`text-xl font-bold ${W>0?"text-amber-600":"text-emerald-600"}`,children:[W," uds"]})]}),ee&&e.jsxs("button",{onClick:we,className:"mt-2 w-full px-3 py-2 bg-white border border-sky-200 text-sky-700 rounded-lg text-xs font-medium hover:bg-sky-50 transition-colors cursor-pointer flex items-center justify-center gap-1.5",children:[e.jsx("i",{className:"ri-robot-line"}),"Volver a modo automático"]})]}),c&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2.5 rounded-lg text-sm flex items-center gap-2",children:[e.jsx("i",{className:"ri-error-warning-line flex-shrink-0"}),c]}),W<=0&&e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 text-emerald-700 px-3 py-2.5 rounded-lg text-sm flex items-center gap-2",children:[e.jsx("i",{className:"ri-checkbox-circle-line flex-shrink-0"}),"Esta tienda ya está completa"]}),e.jsxs("form",{onSubmit:ae,children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Cantidad a confirmar"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{ref:V,type:"number",value:A,onChange:t=>S(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ae()},className:"flex-1 px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 text-2xl font-bold text-center text-gray-900",placeholder:"0",min:"0",step:"1",inputMode:"numeric",disabled:W<=0||!L})})]}),ce.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Distribución por Tienda"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Toca para seleccionar"})]}),e.jsx("div",{className:"border border-gray-200 rounded-xl overflow-hidden",children:ce.map(t=>{const s=t.tienda===Z,o=t.pending>0;return e.jsxs("div",{onClick:()=>ve(t),className:`flex items-center justify-between px-3 py-3 border-b border-gray-100 last:border-b-0 transition-colors ${s?"bg-sky-50":o?"hover:bg-teal-50 cursor-pointer active:bg-teal-100":"opacity-50 cursor-not-allowed"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s?e.jsx("i",{className:"ri-checkbox-circle-fill text-sky-500 text-lg flex-shrink-0"}):o?e.jsx("i",{className:"ri-radio-button-line text-gray-300 text-lg flex-shrink-0"}):e.jsx("i",{className:"ri-checkbox-circle-fill text-emerald-400 text-lg flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx("span",{className:`text-sm font-semibold truncate ${s?"text-sky-700":"text-gray-900"}`,children:t.tienda}),s&&e.jsx("span",{className:"px-1.5 py-0.5 bg-sky-600 text-white text-[10px] font-bold rounded uppercase",children:"Activa"})]}),t.camion&&e.jsxs("span",{className:"text-xs text-amber-600 flex items-center gap-0.5 mt-0.5",children:[e.jsx("i",{className:"ri-truck-line"}),t.camion]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0 ml-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:[t.qty_confirmed,"/",t.qty_to_send]}),e.jsx("div",{className:`text-sm font-bold ${t.pending>0?"text-amber-600":"text-emerald-600"}`,children:t.pending>0?`${t.pending} pend.`:"Listo"})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.status==="DONE"?"bg-emerald-100 text-emerald-700":t.status==="PARTIAL"?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,children:t.status==="DONE"?"Listo":t.status==="PARTIAL"?"Parcial":"Pend."})]})]},t.tienda)})})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{R("scan"),$(""),T(null),F(""),B(!1),S(""),m(""),H.current=null},className:"flex-1 py-3.5 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors cursor-pointer text-sm",children:"Cancelar"}),e.jsx("button",{onClick:ae,disabled:qe,className:"flex-1 py-3.5 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-xl font-semibold hover:from-teal-600 hover:to-cyan-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer text-sm",children:"Confirmar"})]})]})]}),e.jsx("div",{className:"px-4 py-3 md:px-6 md:py-4 border-t border-gray-100 flex-shrink-0",children:e.jsxs("button",{onClick:_e,disabled:!L,className:"w-full py-3.5 bg-gradient-to-r from-rose-500 to-rose-600 text-white rounded-xl font-semibold hover:from-rose-600 hover:to-rose-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer text-sm flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-inbox-line text-lg"}),"Cerrar Distribución"]})})]})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-end md:items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white w-full md:max-w-md md:rounded-xl shadow-2xl rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 md:px-6 md:py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-base md:text-lg font-bold text-gray-900",children:"Cerrar Distribución"}),e.jsx("button",{onClick:()=>{P(!1),K("")},disabled:J,className:"w-8 h-8 flex items-center justify-center rounded-lg text-gray-400 hover:bg-gray-100 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl"})})]}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4 flex items-start gap-2",children:[e.jsx("i",{className:"ri-alert-line text-amber-600 text-lg flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-amber-700",children:"El contenedor cambiará a estado CLOSED y no se podrán agregar más líneas."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Selecciona la tienda"}),e.jsxs("select",{value:U,onChange:t=>K(t.target.value),onFocus:Se,className:"w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500 text-sm cursor-pointer bg-white",disabled:J,children:[e.jsx("option",{value:"",children:"-- Seleccionar tienda --"}),je.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{P(!1),K("")},disabled:J,className:"flex-1 py-3.5 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors cursor-pointer text-sm disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:ke,disabled:!U||J,className:"flex-1 py-3.5 bg-gradient-to-r from-rose-500 to-rose-600 text-white rounded-xl font-semibold hover:from-rose-600 hover:to-rose-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer text-sm flex items-center justify-center gap-2",children:J?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin"}),"Cerrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-check-line"}),"Confirmar Cierre"]})})]})]})]})}),te&&e.jsx(Re,{previousTienda:te.prev,newTienda:te.next,sku:te.sku,onClose:()=>xe(null)}),a&&e.jsx(Ae,{pallet:i,importId:D,onClose:()=>{g(!1),re()},onComplete:()=>{g(!1),x("success","Sobrante procesado","El pallet ha sido liberado"),d()}})]})}function $e(){const{user:i}=ne(),{showToast:f}=ie(),[p,_]=r.useState(""),[d,u]=r.useState(null),[v,x]=r.useState([]),[b,R]=r.useState([]),[k,E]=r.useState(!1),[h,$]=r.useState(!1),l=r.useRef(null);r.useEffect(()=>{l.current?.focus()},[]),r.useEffect(()=>{!h&&!d&&setTimeout(()=>l.current?.focus(),100)},[h,d]);const T=async c=>{c?.preventDefault();const m=p.trim();if(m){E(!0);try{const{data:q,error:P}=await n.from("pallets").select("*").eq("pallet_code",m).maybeSingle();if(P)throw P;if(!q){f("error","Pallet no encontrado","El código no corresponde a ningún pallet registrado"),_(""),l.current?.focus();return}if(q.status==="BLOCKED"){f("warning","Pallet bloqueado","Este pallet está bloqueado y no puede ser utilizado"),_(""),l.current?.focus();return}if(q.locked_by&&q.locked_by!==i?.id){f("warning","Pallet en uso","Este pallet está siendo usado por otro usuario"),_(""),l.current?.focus();return}await n.from("pallets").update({locked_by:i?.id,locked_at:new Date().toISOString()}).eq("id",q.id),await n.from("scan_events").insert({pallet_id:q.id,event_type:"SCAN_PALLET",raw_code:m,user_id:i?.id});const{data:a}=await n.from("pallet_inventory").select("*").eq("pallet_id",q.id).gt("qty_available",0),{data:g}=await n.from("import_lines").select("*").eq("pallet_code",q.pallet_code).in("status",["PENDING","PARTIAL"]);u(q),x(a??[]),R(g??[]),_("")}catch{f("error","Error al leer pallet","No se pudo procesar el código"),_(""),l.current?.focus()}finally{E(!1)}}},A=async()=>{if(d)try{await n.from("pallets").update({locked_by:null,locked_at:null}).eq("id",d.id),await n.from("scan_events").insert({pallet_id:d.id,event_type:"UNLOCK",user_id:i?.id}),u(null),x([]),R([])}catch{f("error","Error","No se pudo liberar el pallet")}},S=async()=>{if(d)try{const{data:c}=await n.from("pallet_inventory").select("*").eq("pallet_id",d.id).gt("qty_available",0),{data:m}=await n.from("import_lines").select("*").eq("pallet_code",d.pallet_code).in("status",["PENDING","PARTIAL"]);x(c??[]),R(m??[])}catch{f("error","Error","No se pudo actualizar la información del pallet")}};return e.jsxs("div",{className:"space-y-4 md:space-y-6 max-w-2xl mx-auto md:max-w-none",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-gray-900",children:"Operación"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-0.5",children:"Escanea pallets y distribuye productos"})]}),e.jsxs(Te,{to:"/operacion/reportes",className:"px-3 py-2 bg-white border border-gray-200 text-gray-700 rounded-lg text-xs md:text-sm font-medium hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer inline-flex items-center gap-1.5",children:[e.jsx("i",{className:"ri-file-chart-line"}),e.jsx("span",{className:"hidden sm:inline",children:"Ver Reportes"}),e.jsx("span",{className:"sm:hidden",children:"Reportes"})]})]}),d?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 p-4 md:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-stack-line text-white text-lg"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base md:text-lg font-bold text-gray-900",children:d.pallet_code}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Ubicación: ",d.ubicacion]})]})]}),e.jsxs("button",{onClick:A,className:"px-3 py-2 border border-gray-200 text-gray-600 rounded-lg text-xs md:text-sm font-medium hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer flex items-center gap-1.5",children:[e.jsx("i",{className:"ri-lock-unlock-line"}),e.jsx("span",{className:"hidden sm:inline",children:"Liberar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Inventario Disponible"}),e.jsx("div",{className:"space-y-2",children:v.length===0?e.jsx("p",{className:"text-sm text-gray-400 py-2",children:"Sin inventario disponible"}):v.map(c=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 font-mono",children:c.sku}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["Inicial: ",c.qty_initial]})]}),e.jsx("span",{className:"text-xl font-bold text-teal-600",children:c.qty_available})]},c.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Pedidos Pendientes"}),e.jsx("div",{className:"space-y-2",children:b.length===0?e.jsx("p",{className:"text-sm text-gray-400 py-2",children:"Sin pedidos pendientes"}):b.map(c=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 font-mono",children:c.sku}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap justify-end",children:[c.camion&&e.jsxs("span",{className:"text-xs font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full inline-flex items-center gap-1",children:[e.jsx("i",{className:"ri-truck-line"}),c.camion]}),e.jsx("span",{className:"text-xs font-medium text-teal-700 bg-teal-50 px-2 py-0.5 rounded-full",children:c.tienda})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Pendiente: ",e.jsx("strong",{children:c.qty_to_send-c.qty_confirmed})," / ",c.qty_to_send]})]},c.id))})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("button",{onClick:()=>$(!0),disabled:v.length===0||b.length===0,className:"w-full py-4 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-xl font-semibold text-base hover:from-teal-600 hover:to-cyan-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-box-3-line text-lg"}),"Iniciar Distribución"]})})]})}):e.jsx("div",{className:"bg-white rounded-xl border border-gray-100 p-6 md:p-12",children:e.jsxs("div",{className:"max-w-sm mx-auto text-center",children:[e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-2xl flex items-center justify-center mx-auto mb-5",children:e.jsx("i",{className:"ri-qr-scan-2-line text-3xl md:text-4xl text-white"})}),e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-2",children:"Leer Pallet"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Escanea el código del pallet con el handheld o ingrésalo manualmente"}),e.jsxs("form",{onSubmit:T,className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none",children:e.jsx("i",{className:"ri-barcode-line text-gray-400 text-lg"})}),e.jsx("input",{ref:l,type:"text",value:p,onChange:c=>_(c.target.value),onKeyDown:c=>{c.key==="Enter"&&T()},placeholder:"Código de pallet...",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,className:"w-full pl-10 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 text-base font-mono tracking-wider text-gray-900 placeholder-gray-400 transition-colors"})]}),e.jsx("button",{type:"submit",disabled:k||!p.trim(),className:"w-full py-4 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-xl font-semibold text-base hover:from-teal-600 hover:to-cyan-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer flex items-center justify-center gap-2",children:k?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg"}),"Buscando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-search-line text-lg"}),"Buscar Pallet"]})})]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-4",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"El handheld enviará el código automáticamente al presionar Enter"]})]})}),h&&d&&e.jsx(Le,{pallet:d,inventory:v,pendingLines:b,onClose:()=>{$(!1),S()},onComplete:()=>{$(!1),A()}})]})}export{$e as default};
//# sourceMappingURL=page-CaoXNQ8O.js.map
