import{c as F,r as d,s as p,j as e,L as R}from"./index-CbDMZEJu.js";function A(){const{showToast:f}=F(),[N,v]=d.useState([]),[n,y]=d.useState("all"),[c,_]=d.useState([]),[i,S]=d.useState([]),[w,b]=d.useState(!0),[u,g]=d.useState("faltantes");d.useEffect(()=>{q()},[]),d.useEffect(()=>{n&&k()},[n]);const q=async()=>{try{const{data:t,error:a}=await p.from("imports").select("*").order("created_at",{ascending:!1});if(a)throw a;v(t||[]),t&&t.length>0&&y("all")}catch(t){console.error("Error cargando imports:",t),f("error","Error","No se pudieron cargar las importaciones")}},k=async()=>{b(!0);try{await Promise.all([C(),$()])}catch(t){console.error("Error cargando reportes:",t),f("error","Error","No se pudieron cargar los reportes")}finally{b(!1)}},C=async()=>{try{let t=p.from("import_lines").select("*, imports!inner(id, file_name)").lt("qty_confirmed",p.raw("qty_to_send"));n!=="all"&&(t=t.eq("import_id",n));const{data:a,error:l}=await t.order("tienda",{ascending:!0});if(l)throw l;const x=(a||[]).map(s=>({import_id:s.import_id,import_name:s.imports.file_name,sku:s.sku,descripcion:s.descripcion,tienda:s.tienda,qty_to_send:s.qty_to_send,qty_confirmed:s.qty_confirmed,faltante:s.qty_to_send-s.qty_confirmed,pallet_code:s.pallet_code}));_(x)}catch(t){throw console.error("Error cargando faltantes:",t),t}},$=async()=>{try{let t=p.from("pallet_inventory").select("*, pallets!inner(id, pallet_code, import_id), imports:pallets(imports(id, file_name))").gt("qty_available",0);const{data:a,error:l}=await t.order("pallet_code",{ascending:!0});if(l)throw l;const x=[];for(const s of a||[]){const h=s.pallets,r=h.import_id;let m=!1;if(r){const{data:o}=await p.from("import_lines").select("id").eq("import_id",r).eq("sku",s.sku).lt("qty_confirmed",p.raw("qty_to_send")).limit(1).maybeSingle();m=!!o}if(n==="all"||r===n){const o=h.imports?.[0]||{};x.push({pallet_id:s.pallet_id,pallet_code:h.pallet_code,sku:s.sku,qty_available:s.qty_available,tiene_demanda:m,import_id:r,import_name:o.file_name})}}S(x)}catch(t){throw console.error("Error cargando sobrantes:",t),t}},j=t=>{try{let a="",l="";t==="faltantes"?(a=`Import,SKU,Descripción,Tienda,Requerido,Confirmado,Faltante,Pallet
`,c.forEach(r=>{const m=r.import_name.replace(/"/g,'""'),o=r.descripcion.replace(/"/g,'""'),D=r.pallet_code.replace(/"/g,'""');a+=`"${m}","${r.sku}","${o}","${r.tienda}",${r.qty_to_send},${r.qty_confirmed},${r.faltante},"${D}"
`}),l=`faltantes_${n}_${new Date().toISOString().split("T")[0]}.csv`):(a=`Import,Pallet,SKU,Cantidad Sobrante,Tiene Demanda
`,i.forEach(r=>{const m=(r.import_name||"N/A").replace(/"/g,'""'),o=r.pallet_code.replace(/"/g,'""');a+=`"${m}","${o}","${r.sku}",${r.qty_available},${r.tiene_demanda?"Sí":"No"}
`}),l=`sobrantes_${n}_${new Date().toISOString().split("T")[0]}.csv`);const x=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),h=URL.createObjectURL(x);s.setAttribute("href",h),s.setAttribute("download",l),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),f("success","Exportado",`Archivo ${l} descargado correctamente`)}catch(a){console.error("Error exportando CSV:",a),f("error","Error","No se pudo exportar el archivo")}},E=c.reduce((t,a)=>t+a.faltante,0),I=i.reduce((t,a)=>t+a.qty_available,0),T=i.filter(t=>!t.tiene_demanda);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(R,{to:"/operacion",className:"text-teal-600 hover:text-teal-700 text-sm font-medium mb-3 inline-flex items-center cursor-pointer",children:[e.jsx("i",{className:"ri-arrow-left-line mr-1"}),"Volver a Operación"]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-1",children:"Reportes de Distribución"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Análisis de faltantes y sobrantes por importación"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filtrar por Importación:"}),e.jsxs("select",{value:n,onChange:t=>y(t.target.value),className:"px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm cursor-pointer min-w-[300px]",children:[e.jsx("option",{value:"all",children:"Todas las importaciones"}),N.map(t=>e.jsxs("option",{value:t.id,children:[t.file_name," - ",new Date(t.created_at).toLocaleDateString()]},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-700",children:"Total Faltantes"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-1",children:E}),e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:[c.length," líneas"]})]}),e.jsx("div",{className:"w-14 h-14 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-error-warning-line text-2xl text-red-600"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-amber-700",children:"Total Sobrantes"}),e.jsx("p",{className:"text-3xl font-bold text-amber-600 mt-1",children:I}),e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[i.length," líneas"]})]}),e.jsx("div",{className:"w-14 h-14 bg-amber-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-inbox-line text-2xl text-amber-600"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-slate-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Sin Demanda"}),e.jsx("p",{className:"text-3xl font-bold text-gray-600 mt-1",children:T.length}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"SKUs sin pedido"})]}),e.jsx("div",{className:"w-14 h-14 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-question-line text-2xl text-gray-600"})})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>g("faltantes"),className:`flex-1 px-6 py-4 text-sm font-medium transition-colors cursor-pointer ${u==="faltantes"?"text-teal-600 border-b-2 border-teal-600 bg-teal-50/50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"ri-error-warning-line mr-2"}),"Faltantes (",c.length,")"]}),e.jsxs("button",{onClick:()=>g("sobrantes"),className:`flex-1 px-6 py-4 text-sm font-medium transition-colors cursor-pointer ${u==="sobrantes"?"text-teal-600 border-b-2 border-teal-600 bg-teal-50/50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"ri-inbox-line mr-2"}),"Sobrantes (",i.length,")"]})]})}),e.jsx("div",{className:"p-5",children:w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-teal-500"})}):e.jsx(e.Fragment,{children:u==="faltantes"?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Productos Faltantes",e.jsx("span",{className:"text-sm font-normal text-gray-500 ml-2",children:"(Requerido > Confirmado)"})]}),e.jsxs("button",{onClick:()=>j("faltantes"),disabled:c.length===0,className:"px-4 py-2 bg-teal-600 text-white rounded-lg text-sm font-medium hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Exportar CSV"]})]}),c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-checkbox-circle-line text-3xl text-emerald-600"})}),e.jsx("p",{className:"text-gray-600 font-medium",children:"No hay faltantes"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Todas las líneas han sido completadas"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Import"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tienda"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Requerido"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Confirmado"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Faltante"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pallet"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t.import_name}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.sku}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.descripcion}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-sky-100 text-sky-700",children:t.tienda})}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-700",children:t.qty_to_send}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-teal-600 font-medium",children:t.qty_confirmed}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700",children:t.faltante})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t.pallet_code})]},a))})]})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Productos Sobrantes",e.jsx("span",{className:"text-sm font-normal text-gray-500 ml-2",children:"(Inventario disponible > 0)"})]}),e.jsxs("button",{onClick:()=>j("sobrantes"),disabled:i.length===0,className:"px-4 py-2 bg-teal-600 text-white rounded-lg text-sm font-medium hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Exportar CSV"]})]}),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-checkbox-circle-line text-3xl text-emerald-600"})}),e.jsx("p",{className:"text-gray-600 font-medium",children:"No hay sobrantes"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Todo el inventario ha sido distribuido"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Import"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pallet"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Cantidad Sobrante"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estado"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t.import_name||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.pallet_code}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t.sku}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-700",children:t.qty_available})}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:t.tiene_demanda?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700",children:[e.jsx("i",{className:"ri-shopping-cart-line mr-1"}),"Con demanda"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700",children:[e.jsx("i",{className:"ri-close-circle-line mr-1"}),"Sin demanda"]})})]},a))})]})})]})})})]})]})}export{A as default};
//# sourceMappingURL=page-O6jDaZYK.js.map
