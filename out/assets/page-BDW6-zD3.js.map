{"version":3,"file":"page-BDW6-zD3.js","sources":["../../src/lib/containerService.ts","../../src/components/scanner/QRScanner.tsx","../../src/pages/operacion/components/TiendaChangePopup.tsx","../../src/pages/operacion/components/DistribucionModal.tsx","../../src/pages/operacion/page.tsx"],"sourcesContent":["import { supabase } from './supabase';\n\n/**\n * Genera el siguiente c√≥digo consecutivo para contenedores\n * Formato: 22O00000001 (22O + 8 d√≠gitos)\n */\nasync function generateContainerCode(): Promise<string> {\n  const prefix = '22O';\n  \n  // Obtener el √∫ltimo c√≥digo generado\n  const { data: lastContainer } = await supabase\n    .from('containers')\n    .select('code')\n    .like('code', `${prefix}%`)\n    .order('code', { ascending: false })\n    .limit(1)\n    .maybeSingle();\n\n  let nextNumber = 1;\n  \n  if (lastContainer?.code) {\n    // Extraer el n√∫mero del c√≥digo anterior\n    const lastNumber = parseInt(lastContainer.code.substring(3), 10);\n    nextNumber = lastNumber + 1;\n  }\n\n  // Formatear con 8 d√≠gitos\n  const paddedNumber = nextNumber.toString().padStart(8, '0');\n  return `${prefix}${paddedNumber}`;\n}\n\n/**\n * Obtiene o crea un contenedor OPEN para una tienda espec√≠fica\n * Si existe un contenedor OPEN para esa tienda e import ‚Üí lo reutiliza\n * Si no existe ‚Üí crea uno nuevo con c√≥digo consecutivo\n */\nexport async function getOrCreateOpenContainer(\n  importId: string,\n  tienda: string,\n  userId: string\n): Promise<string> {\n  const maxRetries = 3;\n  let attempt = 0;\n\n  while (attempt < maxRetries) {\n    try {\n      // 1. Buscar contenedor OPEN existente para esta tienda e import\n      const { data: existingContainer } = await supabase\n        .from('containers')\n        .select('id')\n        .eq('import_id', importId)\n        .eq('tienda', tienda)\n        .eq('status', 'OPEN')\n        .maybeSingle();\n\n      if (existingContainer) {\n        return existingContainer.id;\n      }\n\n      // 2. No existe ‚Üí crear nuevo contenedor\n      const code = await generateContainerCode();\n\n      const { data: newContainer, error: insertError } = await supabase\n        .from('containers')\n        .insert({\n          code,\n          import_id: importId,\n          tienda,\n          status: 'OPEN',\n          created_by: userId,\n        })\n        .select('id')\n        .single();\n\n      if (insertError) {\n        // Si hay error de duplicado de c√≥digo, reintentar\n        if (insertError.code === '23505') {\n          attempt++;\n          continue;\n        }\n        throw insertError;\n      }\n\n      return newContainer.id;\n    } catch (error) {\n      attempt++;\n      if (attempt >= maxRetries) {\n        throw new Error(`Error al crear contenedor despu√©s de ${maxRetries} intentos: ${error}`);\n      }\n      // Esperar un poco antes de reintentar\n      await new Promise(resolve => setTimeout(resolve, 100 * attempt));\n    }\n  }\n\n  throw new Error('No se pudo crear el contenedor');\n}\n\n/**\n * Verifica si un contenedor est√° en estado que permite agregar l√≠neas\n */\nexport async function isContainerEditable(containerId: string): Promise<boolean> {\n  const { data: container } = await supabase\n    .from('containers')\n    .select('status')\n    .eq('id', containerId)\n    .maybeSingle();\n\n  return container?.status === 'OPEN';\n}\n\n/**\n * Obtiene todos los contenedores OPEN de un import\n */\nexport async function getOpenContainersByImport(importId: string) {\n  const { data, error } = await supabase\n    .from('containers')\n    .select('id, code, tienda, created_at')\n    .eq('import_id', importId)\n    .eq('status', 'OPEN')\n    .order('created_at', { ascending: false });\n\n  if (error) throw error;\n  return data || [];\n}\n\n/**\n * Valida y registra una l√≠nea en el contenedor con validaciones de concurrencia\n * Retorna true si se insert√≥ correctamente, false si hubo error\n */\nexport async function addContainerLineWithValidation(\n  containerId: string,\n  palletId: string,\n  sku: string,\n  qty: number,\n  sourceImportLineId: string\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    // ‚úÖ VALIDACI√ìN 1: Verificar que el contenedor est√© OPEN\n    const { data: container } = await supabase\n      .from('containers')\n      .select('status')\n      .eq('id', containerId)\n      .maybeSingle();\n\n    if (!container) {\n      return { success: false, error: 'Contenedor no encontrado' };\n    }\n\n    if (container.status !== 'OPEN') {\n      return { success: false, error: `El contenedor est√° en estado ${container.status} y no permite agregar l√≠neas` };\n    }\n\n    // ‚úÖ VALIDACI√ìN 2: Verificar inventario disponible en tiempo real\n    const { data: inventory } = await supabase\n      .from('pallet_inventory')\n      .select('qty_available')\n      .eq('pallet_id', palletId)\n      .eq('sku', sku)\n      .maybeSingle();\n\n    if (!inventory || inventory.qty_available < qty) {\n      return { success: false, error: 'Cantidad no disponible en inventario del pallet' };\n    }\n\n    // ‚úÖ VALIDACI√ìN 3: Verificar pendiente de la l√≠nea de importaci√≥n\n    const { data: importLine } = await supabase\n      .from('import_lines')\n      .select('qty_to_send, qty_confirmed')\n      .eq('id', sourceImportLineId)\n      .maybeSingle();\n\n    if (!importLine) {\n      return { success: false, error: 'L√≠nea de importaci√≥n no encontrada' };\n    }\n\n    const pending = importLine.qty_to_send - importLine.qty_confirmed;\n    if (qty > pending) {\n      return { success: false, error: 'Cantidad mayor al pendiente del pedido' };\n    }\n\n    // ‚úÖ INSERTAR L√çNEA EN CONTENEDOR\n    const { error: insertError } = await supabase\n      .from('container_lines')\n      .insert({\n        container_id: containerId,\n        pallet_id: palletId,\n        sku,\n        qty,\n        source_import_line_id: sourceImportLineId,\n      });\n\n    if (insertError) {\n      return { success: false, error: `Error al insertar l√≠nea: ${insertError.message}` };\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error('Error en addContainerLineWithValidation:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Error desconocido' };\n  }\n}\n\n/**\n * Cierra un contenedor y valida que tenga l√≠neas\n */\nexport async function closeContainer(\n  containerId: string,\n  userId: string\n): Promise<{ success: boolean; error?: string; code?: string; lineCount?: number }> {\n  try {\n    // ‚úÖ VALIDACI√ìN 1: Verificar que el contenedor exista y est√© OPEN\n    const { data: container } = await supabase\n      .from('containers')\n      .select('id, code, status')\n      .eq('id', containerId)\n      .maybeSingle();\n\n    if (!container) {\n      return { success: false, error: 'Contenedor no encontrado' };\n    }\n\n    if (container.status !== 'OPEN') {\n      return { success: false, error: `El contenedor ya est√° en estado ${container.status}` };\n    }\n\n    // ‚úÖ VALIDACI√ìN 2: Verificar que tenga l√≠neas\n    const { data: lines, count } = await supabase\n      .from('container_lines')\n      .select('id', { count: 'exact' })\n      .eq('container_id', containerId);\n\n    if (!count || count === 0) {\n      return { success: false, error: 'El contenedor no tiene l√≠neas. Confirma cantidades antes de cerrar.' };\n    }\n\n    // ‚úÖ CERRAR CONTENEDOR\n    const { error: updateError } = await supabase\n      .from('containers')\n      .update({\n        status: 'CLOSED',\n        closed_at: new Date().toISOString(),\n      })\n      .eq('id', containerId);\n\n    if (updateError) {\n      return { success: false, error: `Error al cerrar contenedor: ${updateError.message}` };\n    }\n\n    return { success: true, code: container.code, lineCount: count };\n  } catch (error) {\n    console.error('Error en closeContainer:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Error desconocido' };\n  }\n}\n","import { useEffect, useRef, useState } from 'react';\n\ninterface Props {\n  onScan: (code: string) => void;\n  onClose: () => void;\n}\n\nexport default function QRScanner({ onScan, onClose }: Props) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const [manualCode, setManualCode] = useState('');\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    startCamera();\n    return () => {\n      stopCamera();\n    };\n  }, []);\n\n  const startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { facingMode: 'environment' },\n      });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n      }\n    } catch (err) {\n      setError('No se pudo acceder a la c√°mara');\n      console.error('Error accediendo a la c√°mara:', err);\n    }\n  };\n\n  const stopCamera = () => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      const stream = videoRef.current.srcObject as MediaStream;\n      stream.getTracks().forEach((track) => track.stop());\n    }\n  };\n\n  const handleManualSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (manualCode.trim()) {\n      onScan(manualCode.trim());\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-xl shadow-xl max-w-2xl w-full\">\n        <div className=\"p-6 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-2xl font-bold text-gray-900\">Escanear Pallet Padre</h2>\n            <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 cursor-pointer\">\n              <i className=\"ri-close-line text-2xl\"></i>\n            </button>\n          </div>\n        </div>\n\n        <div className=\"p-6\">\n          {error ? (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm mb-6\">\n              {error}\n            </div>\n          ) : (\n            <div className=\"mb-6\">\n              <video ref={videoRef} autoPlay playsInline className=\"w-full rounded-lg bg-black\" />\n              <p className=\"text-center text-sm text-gray-600 mt-4\">\n                Coloca el c√≥digo QR frente a la c√°mara\n              </p>\n            </div>\n          )}\n\n          <div className=\"border-t border-gray-200 pt-6\">\n            <p className=\"text-sm font-medium text-gray-700 mb-4\">O ingresa el c√≥digo del pallet padre manualmente:</p>\n            <form onSubmit={handleManualSubmit} className=\"flex items-center space-x-4\">\n              <input\n                type=\"text\"\n                value={manualCode}\n                onChange={(e) => setManualCode(e.target.value)}\n                className=\"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm\"\n                placeholder=\"C√≥digo del pallet o SKU\"\n              />\n              <button\n                type=\"submit\"\n                className=\"px-6 py-3 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-lg font-medium hover:from-teal-600 hover:to-cyan-700 transition-all whitespace-nowrap\"\n              >\n                Confirmar\n              </button>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","\nimport { useEffect, useState } from 'react';\n\ninterface Props {\n  previousTienda: string;\n  newTienda: string;\n  sku: string;\n  onClose: () => void;\n}\n\nexport default function TiendaChangePopup({ previousTienda, newTienda, sku, onClose }: Props) {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    requestAnimationFrame(() => setIsVisible(true));\n  }, []);\n\n  const handleClose = () => {\n    setIsVisible(false);\n    setTimeout(onClose, 250);\n  };\n\n  return (\n    <div\n      className={`fixed inset-0 z-[70] flex items-center justify-center p-4 transition-all duration-250 ${isVisible ? 'bg-black/40' : 'bg-black/0'}`}\n      onClick={handleClose}\n    >\n      <div\n        className={`bg-white rounded-2xl shadow-2xl max-w-sm w-full overflow-hidden transition-all duration-250 ${isVisible ? 'scale-100 opacity-100' : 'scale-95 opacity-0'}`}\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className=\"bg-gradient-to-r from-sky-500 to-cyan-500 px-6 py-5 text-center\">\n          <div className=\"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-3\">\n            <i className=\"ri-store-2-line text-3xl text-white\"></i>\n          </div>\n          <h3 className=\"text-lg font-bold text-white\">Cambio de Tienda</h3>\n        </div>\n\n        <div className=\"px-6 py-5\">\n          <p className=\"text-sm text-gray-500 text-center mb-5\">\n            El SKU <span className=\"font-semibold text-gray-800\">{sku}</span> ahora se distribuye a otra tienda\n          </p>\n\n          <div className=\"flex items-center justify-center gap-3 mb-5\">\n            <div className=\"flex-1 text-center bg-gray-50 rounded-xl py-3 px-2 border border-gray-100\">\n              <p className=\"text-[10px] uppercase tracking-wider text-gray-400 font-medium mb-1\">Anterior</p>\n              <p className=\"text-sm font-bold text-gray-700\">{previousTienda}</p>\n            </div>\n            <div className=\"w-8 h-8 flex items-center justify-center flex-shrink-0\">\n              <i className=\"ri-arrow-right-line text-xl text-sky-500\"></i>\n            </div>\n            <div className=\"flex-1 text-center bg-sky-50 rounded-xl py-3 px-2 border border-sky-100\">\n              <p className=\"text-[10px] uppercase tracking-wider text-sky-400 font-medium mb-1\">Nueva</p>\n              <p className=\"text-sm font-bold text-sky-700\">{newTienda}</p>\n            </div>\n          </div>\n\n          <button\n            onClick={handleClose}\n            className=\"w-full py-3 bg-gradient-to-r from-sky-500 to-cyan-500 text-white rounded-xl font-medium text-sm hover:from-sky-600 hover:to-cyan-600 transition-all whitespace-nowrap cursor-pointer\"\n          >\n            Entendido\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useRef, useEffect } from 'react';\nimport { supabase, Pallet, PalletInventory, ImportLine } from '../../../lib/supabase';\nimport { getOrCreateOpenContainer, isContainerEditable } from '../../../lib/containerService';\nimport { useAuth } from '../../../contexts/AuthContext';\nimport { useToast } from '../../../components/base/Toast';\nimport QRScanner from '../../../components/scanner/QRScanner';\nimport TiendaChangePopup from './TiendaChangePopup';\n\ninterface Props {\n  pallet: Pallet;\n  inventory: PalletInventory[];\n  pendingLines: ImportLine[];\n  onClose: () => void;\n  onComplete: () => void;\n}\n\ninterface TiendaProgress {\n  tienda: string;\n  camion: string;\n  qty_to_send: number;\n  qty_confirmed: number;\n  pending: number;\n  status: 'PENDING' | 'PARTIAL' | 'DONE';\n  importLineId: string;\n}\n\nexport default function DistribucionModal({ pallet, inventory, pendingLines, onClose, onComplete }: Props) {\n  const { user, loading: authLoading } = useAuth();\n  const { showToast } = useToast();\n  const [step, setStep] = useState<'scan' | 'confirm'>('scan');\n  const [showScanner, setShowScanner] = useState(false);\n  const [selectedSku, setSelectedSku] = useState('');\n  const [selectedLine, setSelectedLine] = useState<ImportLine | null>(null);\n  const [quantity, setQuantity] = useState('');\n  const [error, setError] = useState('');\n  const [showCloseModal, setShowCloseModal] = useState(false);\n  const [selectedTiendaToClose, setSelectedTiendaToClose] = useState('');\n  const [closingInProgress, setClosingInProgress] = useState(false);\n  const [availableTiendas, setAvailableTiendas] = useState<string[]>([]);\n\n  // Estado para selecci√≥n manual de tienda\n  const [selectedStore, setSelectedStore] = useState<string>('');\n  const [manualStoreSelection, setManualStoreSelection] = useState(false);\n\n  // Estado para progreso del SKU y tiendas\n  const [skuProgress, setSkuProgress] = useState<{ total: number; confirmed: number; percentage: number } | null>(null);\n  const [tiendasProgress, setTiendasProgress] = useState<TiendaProgress[]>([]);\n  // Cache de l√≠neas completas para selecci√≥n r√°pida\n  const [skuLinesCache, setSkuLinesCache] = useState<ImportLine[]>([]);\n\n  // Estado para popup de cambio de tienda\n  const [tiendaChange, setTiendaChange] = useState<{ prev: string; next: string; sku: string } | null>(null);\n  const previousTiendaRef = useRef<string | null>(null);\n\n  // Verificar si el usuario est√° cargado\n  const hasUser = !authLoading && user !== null;\n\n  // Calcular progreso del SKU y tiendas cuando cambia selectedSku o selectedStore\n  useEffect(() => {\n    if (selectedSku && step === 'confirm') {\n      loadSkuProgress();\n    } else {\n      setSkuProgress(null);\n      setTiendasProgress([]);\n      setSkuLinesCache([]);\n    }\n  }, [selectedSku, step]);\n\n  const loadSkuProgress = async () => {\n    try {\n      const { data: lines } = await supabase\n        .from('import_lines')\n        .select('*')\n        .eq('pallet_code', pallet.pallet_code)\n        .eq('sku', selectedSku)\n        .order('tienda', { ascending: true });\n\n      if (!lines || lines.length === 0) return;\n\n      // Guardar cache de l√≠neas\n      setSkuLinesCache(lines);\n\n      const total = lines.reduce((sum, l) => sum + l.qty_to_send, 0);\n      const confirmed = lines.reduce((sum, l) => sum + l.qty_confirmed, 0);\n      const percentage = total > 0 ? Math.round((confirmed / total) * 100) : 0;\n\n      setSkuProgress({ total, confirmed, percentage });\n\n      const tiendas: TiendaProgress[] = lines.map((line) => ({\n        tienda: line.tienda,\n        camion: line.camion || '',\n        qty_to_send: line.qty_to_send,\n        qty_confirmed: line.qty_confirmed,\n        pending: line.qty_to_send - line.qty_confirmed,\n        status: line.status,\n        importLineId: line.id,\n      }));\n\n      setTiendasProgress(tiendas);\n    } catch (err) {\n      console.error('Error cargando progreso del SKU:', err);\n    }\n  };\n\n  /**\n   * Obtiene la siguiente l√≠nea pendiente para un SKU\n   */\n  const getNextPendingLine = async (sku: string): Promise<ImportLine | null> => {\n    try {\n      const { data: lines } = await supabase\n        .from('import_lines')\n        .select('*')\n        .eq('pallet_code', pallet.pallet_code)\n        .eq('sku', sku)\n        .in('status', ['PENDING', 'PARTIAL'])\n        .order('tienda', { ascending: true });\n\n      if (!lines || lines.length === 0) return null;\n      \n      const nextLine = lines.find((l) => l.qty_confirmed < l.qty_to_send);\n      return nextLine || null;\n    } catch (err) {\n      console.error('Error buscando siguiente l√≠nea:', err);\n      return null;\n    }\n  };\n\n  /**\n   * Selecciona una tienda de la tabla manualmente\n   */\n  const handleStoreClick = (tienda: TiendaProgress) => {\n    if (tienda.pending <= 0) {\n      showToast('warning', 'Tienda completa', `${tienda.tienda} ya tiene todas las unidades confirmadas`);\n      return;\n    }\n\n    // Buscar la l√≠nea correspondiente en el cache\n    const line = skuLinesCache.find((l) => l.tienda === tienda.tienda);\n    if (!line) return;\n\n    const prevStore = selectedStore;\n    setSelectedStore(tienda.tienda);\n    setSelectedLine(line);\n    setManualStoreSelection(true);\n    setQuantity('');\n    setError('');\n\n    if (prevStore && prevStore !== tienda.tienda) {\n      showToast('info', 'Tienda cambiada', `Ahora distribuyendo a ${tienda.tienda}`);\n    }\n  };\n\n  /**\n   * Volver al modo autom√°tico\n   */\n  const handleBackToAuto = async () => {\n    setManualStoreSelection(false);\n    const nextLine = await getNextPendingLine(selectedSku);\n    if (nextLine) {\n      setSelectedLine(nextLine);\n      setSelectedStore(nextLine.tienda);\n      setQuantity('');\n      setError('');\n      showToast('info', 'Modo autom√°tico', `Tienda activa: ${nextLine.tienda}`);\n    }\n  };\n\n  const handleSkuScan = async (code: string) => {\n    setShowScanner(false);\n    setError('');\n\n    let resolvedSku = code;\n    let inv = inventory.find((i) => i.sku === code);\n\n    if (!inv) {\n      const { data: lineByBarcode } = await supabase\n        .from('import_lines')\n        .select('sku')\n        .eq('barcode', code)\n        .eq('pallet_code', pallet.pallet_code)\n        .limit(1)\n        .maybeSingle();\n\n      if (lineByBarcode) {\n        resolvedSku = lineByBarcode.sku;\n        inv = inventory.find((i) => i.sku === resolvedSku);\n      }\n    }\n\n    if (!inv) {\n      setError('SKU/C√≥digo de barra no encontrado en este pallet');\n      return;\n    }\n\n    const { data: currentInv } = await supabase\n      .from('pallet_inventory')\n      .select('*')\n      .eq('id', inv.id)\n      .maybeSingle();\n\n    if (!currentInv || currentInv.qty_available <= 0) {\n      setError('No hay cantidad disponible para este SKU en el pallet');\n      return;\n    }\n\n    // Obtener todas las l√≠neas pendientes para este SKU\n    const { data: allLines } = await supabase\n      .from('import_lines')\n      .select('*')\n      .eq('pallet_code', pallet.pallet_code)\n      .eq('sku', resolvedSku)\n      .in('status', ['PENDING', 'PARTIAL'])\n      .order('tienda', { ascending: true });\n\n    if (!allLines || allLines.length === 0) {\n      setError('No hay pedidos pendientes para este SKU');\n      return;\n    }\n\n    // Seleccionar la primera l√≠nea con pendiente > 0 (modo autom√°tico por defecto)\n    const defaultLine = allLines.find((l) => l.qty_confirmed < l.qty_to_send);\n    if (!defaultLine) {\n      setError('No hay pedidos pendientes para este SKU');\n      return;\n    }\n\n    // Guardar cache\n    setSkuLinesCache(allLines);\n\n    if (hasUser) {\n      await supabase.from('scan_events').insert({\n        pallet_id: pallet.id,\n        event_type: 'SCAN_SKU',\n        raw_code: code,\n        sku: resolvedSku,\n        tienda: defaultLine.tienda,\n        user_id: user.id,\n      });\n    }\n\n    // Inicializar en modo autom√°tico\n    previousTiendaRef.current = defaultLine.tienda;\n    setSelectedSku(resolvedSku);\n    setSelectedLine(defaultLine);\n    setSelectedStore(defaultLine.tienda);\n    setManualStoreSelection(false);\n    setStep('confirm');\n  };\n\n  const handleConfirm = async () => {\n    console.log('üîµ handleConfirm iniciado');\n\n    if (!hasUser) {\n      console.log('‚ùå Usuario no disponible');\n      setError('Sesi√≥n no cargada. Por favor, vuelve a iniciar sesi√≥n.');\n      showToast('error', 'Error de sesi√≥n', 'Tu sesi√≥n no est√° cargada correctamente. Vuelve a iniciar sesi√≥n.');\n      return;\n    }\n\n    if (!selectedLine || !quantity) {\n      console.log('‚ùå Validaci√≥n inicial fallida');\n      return;\n    }\n\n    const qty = parseFloat(quantity);\n    if (qty <= 0) {\n      setError('La cantidad debe ser mayor a 0');\n      return;\n    }\n\n    const pending = selectedLine.qty_to_send - selectedLine.qty_confirmed;\n    if (pending <= 0) {\n      setError('Esta l√≠nea ya est√° completa');\n      return;\n    }\n\n    const { data: currentInv } = await supabase\n      .from('pallet_inventory')\n      .select('*')\n      .eq('pallet_id', pallet.id)\n      .eq('sku', selectedSku)\n      .maybeSingle();\n\n    if (!currentInv || qty > currentInv.qty_available) {\n      setError('Cantidad mayor al disponible en pallet');\n      return;\n    }\n\n    if (qty > pending) {\n      setError('Cantidad mayor al pendiente del pedido');\n      return;\n    }\n\n    try {\n      const containerId = await getOrCreateOpenContainer(\n        selectedLine.import_id,\n        selectedLine.tienda,\n        user!.id\n      );\n\n      const editable = await isContainerEditable(containerId);\n      if (!editable) {\n        setError('El contenedor de esta tienda ya est√° cerrado');\n        return;\n      }\n\n      const { error: invError } = await supabase\n        .from('pallet_inventory')\n        .update({ qty_available: currentInv.qty_available - qty })\n        .eq('id', currentInv.id);\n\n      if (invError) throw invError;\n\n      const newConfirmed = selectedLine.qty_confirmed + qty;\n      const newStatus = newConfirmed >= selectedLine.qty_to_send ? 'DONE' : 'PARTIAL';\n\n      const { error: lineError } = await supabase\n        .from('import_lines')\n        .update({\n          qty_confirmed: newConfirmed,\n          status: newStatus,\n          ...(newStatus === 'DONE' ? { done_at: new Date().toISOString(), done_by: user!.id } : {}),\n        })\n        .eq('id', selectedLine.id);\n\n      if (lineError) throw lineError;\n\n      const { error: containerLineError } = await supabase.from('container_lines').insert({\n        container_id: containerId,\n        pallet_id: pallet.id,\n        sku: selectedSku,\n        qty,\n        source_import_line_id: selectedLine.id,\n      });\n\n      if (containerLineError) throw containerLineError;\n\n      const { error: moveError } = await supabase.from('distribution_moves').insert({\n        import_id: selectedLine.import_id,\n        pallet_id: pallet.id,\n        sku: selectedSku,\n        tienda: selectedLine.tienda,\n        qty,\n        user_id: user!.id,\n        source_import_line_id: selectedLine.id,\n      });\n\n      if (moveError) throw moveError;\n\n      await supabase.from('scan_events').insert({\n        pallet_id: pallet.id,\n        event_type: 'CONFIRM_QTY',\n        sku: selectedSku,\n        tienda: selectedLine.tienda,\n        qty,\n        user_id: user!.id,\n      });\n\n      showToast('success', 'Cantidad confirmada', `${qty} uds de ${selectedSku} ‚Üí ${selectedLine.tienda}`);\n\n      // Recargar progreso del SKU\n      await loadSkuProgress();\n\n      // L√≥gica de auto-advance\n      const currentStorePending = newConfirmed >= selectedLine.qty_to_send ? 0 : selectedLine.qty_to_send - newConfirmed;\n\n      // Si es selecci√≥n manual y la tienda a√∫n tiene pendiente, mantenerla\n      if (manualStoreSelection && currentStorePending > 0) {\n        // Actualizar selectedLine con los nuevos valores\n        setSelectedLine({\n          ...selectedLine,\n          qty_confirmed: newConfirmed,\n          status: newStatus as any,\n        });\n        setQuantity('');\n        setError('');\n        return;\n      }\n\n      // Si la tienda se complet√≥ o es modo autom√°tico, buscar siguiente\n      const nextLine = await getNextPendingLine(selectedSku);\n\n      const { data: updatedInv } = await supabase\n        .from('pallet_inventory')\n        .select('*')\n        .eq('pallet_id', pallet.id)\n        .eq('sku', selectedSku)\n        .maybeSingle();\n\n      const hasInventory = updatedInv && updatedInv.qty_available > 0;\n\n      if (nextLine && hasInventory) {\n        // Detectar cambio de tienda\n        const prevTienda = previousTiendaRef.current;\n        if (prevTienda && prevTienda !== nextLine.tienda) {\n          setTiendaChange({\n            prev: prevTienda,\n            next: nextLine.tienda,\n            sku: selectedSku,\n          });\n        }\n        \n        previousTiendaRef.current = nextLine.tienda;\n        setSelectedLine(nextLine);\n        setSelectedStore(nextLine.tienda);\n        setManualStoreSelection(false);\n        setQuantity('');\n        setError('');\n      } else {\n        // No quedan tiendas pendientes para este SKU ‚Üí volver a scan\n        setStep('scan');\n        setSelectedSku('');\n        setSelectedLine(null);\n        setSelectedStore('');\n        setManualStoreSelection(false);\n        setQuantity('');\n        setError('');\n        previousTiendaRef.current = null;\n\n        const { data: allInv } = await supabase\n          .from('pallet_inventory')\n          .select('*')\n          .eq('pallet_id', pallet.id)\n          .gt('qty_available', 0);\n\n        if (!allInv || allInv.length === 0) {\n          showToast('info', 'Pallet agotado', 'Todo el inventario de este pallet ha sido distribuido');\n          onComplete();\n        }\n      }\n    } catch (err) {\n      console.error('‚ùå Error en handleConfirm:', err);\n      setError(`Error al confirmar cantidad: ${err instanceof Error ? err.message : 'Error desconocido'}`);\n    }\n  };\n\n  const handleOpenCloseModal = async () => {\n    if (!hasUser) {\n      showToast('error', 'Error de sesi√≥n', 'Tu sesi√≥n no est√° cargada. Vuelve a iniciar sesi√≥n.');\n      return;\n    }\n\n    const importId = pendingLines[0]?.import_id;\n    if (!importId) {\n      showToast('error', 'Error', 'No se encontr√≥ el ID de importaci√≥n');\n      return;\n    }\n\n    const { data: openContainers } = await supabase\n      .from('containers')\n      .select('tienda')\n      .eq('import_id', importId)\n      .eq('status', 'OPEN');\n\n    if (!openContainers || openContainers.length === 0) {\n      showToast('warning', 'Sin contenedores', 'No hay contenedores abiertos para cerrar');\n      return;\n    }\n\n    const tiendas = [...new Set(openContainers.map((c) => c.tienda))];\n    setAvailableTiendas(tiendas);\n\n    if (tiendas.length === 1) {\n      setSelectedTiendaToClose(tiendas[0]);\n    }\n    setShowCloseModal(true);\n  };\n\n  const handleCerrarDistribucion = async () => {\n    if (!hasUser) {\n      showToast('error', 'Error de sesi√≥n', 'Tu sesi√≥n no est√° cargada. Vuelve a iniciar sesi√≥n.');\n      return;\n    }\n\n    if (!selectedTiendaToClose) {\n      setError('Debes seleccionar una tienda');\n      return;\n    }\n\n    setClosingInProgress(true);\n\n    try {\n      const importId = pendingLines[0]?.import_id;\n      if (!importId) {\n        throw new Error('No se encontr√≥ el ID de importaci√≥n');\n      }\n\n      const { data: openContainer } = await supabase\n        .from('containers')\n        .select('id, code')\n        .eq('import_id', importId)\n        .eq('tienda', selectedTiendaToClose)\n        .eq('status', 'OPEN')\n        .maybeSingle();\n\n      if (!openContainer) {\n        showToast('error', 'Sin contenedor', 'No hay contenedor abierto para esta tienda');\n        setShowCloseModal(false);\n        setSelectedTiendaToClose('');\n        return;\n      }\n\n      const { count } = await supabase\n        .from('container_lines')\n        .select('id', { count: 'exact' })\n        .eq('container_id', openContainer.id);\n\n      if (!count || count === 0) {\n        showToast('warning', 'Contenedor vac√≠o', 'Confirma cantidades antes de cerrar el contenedor');\n        setShowCloseModal(false);\n        setSelectedTiendaToClose('');\n        return;\n      }\n\n      const { error: updateError } = await supabase\n        .from('containers')\n        .update({\n          status: 'CLOSED',\n          closed_at: new Date().toISOString(),\n        })\n        .eq('id', openContainer.id);\n\n      if (updateError) throw updateError;\n\n      await supabase.from('scan_events').insert({\n        pallet_id: pallet.id,\n        event_type: 'CLOSE',\n        tienda: selectedTiendaToClose,\n        notes: `Contenedor ${openContainer.code} cerrado con ${count} l√≠neas`,\n        user_id: user!.id,\n      });\n\n      showToast(\n        'success',\n        `Contenedor ${openContainer.code} cerrado`,\n        `Tienda: ${selectedTiendaToClose} ¬∑ ${count} l√≠neas registradas`,\n        6000\n      );\n\n      setShowCloseModal(false);\n      setSelectedTiendaToClose('');\n      onComplete();\n    } catch (err) {\n      console.error('Error cerrando distribuci√≥n:', err);\n      showToast('error', 'Error al cerrar', err instanceof Error ? err.message : 'Error desconocido');\n    } finally {\n      setClosingInProgress(false);\n    }\n  };\n\n  const loadAvailableTiendas = async () => {\n    const importId = pendingLines[0]?.import_id;\n    if (!importId) return;\n\n    const { data: openContainers } = await supabase\n      .from('containers')\n      .select('tienda')\n      .eq('import_id', importId)\n      .eq('status', 'OPEN');\n\n    if (openContainers) {\n      const tiendas = [...new Set(openContainers.map((c) => c.tienda))];\n      setAvailableTiendas(tiendas);\n      if (tiendas.length === 1) {\n        setSelectedTiendaToClose(tiendas[0]);\n      }\n    }\n  };\n\n  const currentPending = selectedLine ? selectedLine.qty_to_send - selectedLine.qty_confirmed : 0;\n  const isConfirmDisabled = !hasUser || !quantity || parseFloat(quantity) <= 0 || currentPending <= 0;\n  const isCloseDisabled = !hasUser;\n\n  return (\n    <>\n      <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n        <div className=\"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n          <div className=\"p-6 border-b border-gray-200\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Distribuci√≥n - {pallet.pallet_code}</h2>\n              <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 cursor-pointer\">\n                <i className=\"ri-close-line text-2xl\"></i>\n              </button>\n            </div>\n          </div>\n\n          <div className=\"p-6\">\n            {/* Mensaje de error de sesi√≥n */}\n            {!hasUser && (\n              <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\n                <div className=\"flex items-start\">\n                  <i className=\"ri-error-warning-line text-red-600 text-xl mr-3 mt-0.5\"></i>\n                  <div>\n                    <p className=\"text-sm font-medium text-red-900 mb-1\">Sesi√≥n no cargada</p>\n                    <p className=\"text-sm text-red-700\">\n                      {authLoading \n                        ? 'Cargando tu sesi√≥n...' \n                        : 'Tu sesi√≥n no est√° disponible. Por favor, vuelve a iniciar sesi√≥n para continuar.'}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {step === 'scan' ? (\n              <div className=\"text-center\">\n                <div className=\"w-20 h-20 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-2xl flex items-center justify-center mx-auto mb-6\">\n                  <i className=\"ri-barcode-line text-4xl text-white\"></i>\n                </div>\n                <h3 className=\"text-xl font-bold text-gray-900 mb-4\">Escanear SKU / C√≥digo de Barra</h3>\n                <p className=\"text-gray-600 mb-8\">Escanea el c√≥digo del producto o su c√≥digo de barras</p>\n\n                {error && (\n                  <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm mb-6\">\n                    {error}\n                  </div>\n                )}\n\n                <button\n                  onClick={() => setShowScanner(true)}\n                  disabled={!hasUser}\n                  className=\"px-8 py-4 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-lg font-medium hover:from-teal-600 hover:to-cyan-700 transition-all whitespace-nowrap cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  <i className=\"ri-camera-line mr-2\"></i>\n                  Escanear SKU / C√≥digo de Barra\n                </button>\n              </div>\n            ) : (\n              <div>\n                {/* Progreso del SKU */}\n                {skuProgress && (\n                  <div className=\"bg-gradient-to-r from-teal-50 to-cyan-50 border border-teal-200 rounded-xl p-5 mb-6\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div>\n                        <h3 className=\"text-lg font-bold text-gray-900\">{selectedSku}</h3>\n                        <p className=\"text-sm text-gray-600\">Progreso total del SKU</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"text-3xl font-bold text-teal-600\">{skuProgress.percentage}%</div>\n                        <div className=\"text-xs text-gray-500\">\n                          {skuProgress.confirmed} / {skuProgress.total} uds\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"w-full bg-gray-200 rounded-full h-3 overflow-hidden\">\n                      <div\n                        className=\"bg-gradient-to-r from-teal-500 to-cyan-600 h-full rounded-full transition-all duration-500\"\n                        style={{ width: `${skuProgress.percentage}%` }}\n                      ></div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Informaci√≥n de tienda activa */}\n                <div className=\"bg-sky-50 border border-sky-200 rounded-lg p-4 mb-6\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm font-medium text-gray-700\">Tienda Activa:</span>\n                      <span className=\"text-lg font-bold text-sky-600\">{selectedStore}</span>\n                      {selectedLine?.camion && (\n                        <span className=\"text-xs font-medium text-amber-600 bg-amber-100 px-2 py-1 rounded-full inline-flex items-center\">\n                          <i className=\"ri-truck-line mr-1\"></i>\n                          {selectedLine.camion}\n                        </span>\n                      )}\n                    </div>\n                    <span\n                      className={`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold ${\n                        manualStoreSelection\n                          ? 'bg-amber-100 text-amber-700'\n                          : 'bg-teal-100 text-teal-700'\n                      }`}\n                    >\n                      {manualStoreSelection ? (\n                        <>\n                          <i className=\"ri-hand-coin-line mr-1\"></i>\n                          Manual\n                        </>\n                      ) : (\n                        <>\n                          <i className=\"ri-robot-line mr-1\"></i>\n                          Autom√°tica\n                        </>\n                      )}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm font-medium text-gray-700\">Pendiente:</span>\n                    <span className={`text-lg font-bold ${currentPending > 0 ? 'text-amber-600' : 'text-emerald-600'}`}>\n                      {currentPending} uds\n                    </span>\n                  </div>\n                  {manualStoreSelection && (\n                    <button\n                      onClick={handleBackToAuto}\n                      className=\"mt-3 w-full px-3 py-2 bg-white border border-sky-200 text-sky-700 rounded-lg text-xs font-medium hover:bg-sky-50 transition-colors whitespace-nowrap cursor-pointer flex items-center justify-center gap-1.5\"\n                    >\n                      <i className=\"ri-robot-line\"></i>\n                      Volver a modo autom√°tico\n                    </button>\n                  )}\n                </div>\n\n                {error && (\n                  <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm mb-6\">\n                    {error}\n                  </div>\n                )}\n\n                {currentPending <= 0 && (\n                  <div className=\"bg-emerald-50 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-lg text-sm mb-6\">\n                    <i className=\"ri-checkbox-circle-line mr-2\"></i>\n                    Esta tienda ya est√° completa\n                  </div>\n                )}\n\n                <div className=\"mb-6\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Cantidad a confirmar</label>\n                  <input\n                    type=\"number\"\n                    value={quantity}\n                    onChange={(e) => setQuantity(e.target.value)}\n                    className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-lg\"\n                    placeholder=\"0\"\n                    min=\"0\"\n                    step=\"0.01\"\n                    disabled={currentPending <= 0 || !hasUser}\n                  />\n                </div>\n\n                {/* Lista de tiendas con progreso - CLICKEABLE */}\n                {tiendasProgress.length > 0 && (\n                  <div className=\"mb-6\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <h4 className=\"text-sm font-semibold text-gray-900\">Distribuci√≥n por Tienda</h4>\n                      <p className=\"text-xs text-gray-500\">Haz clic en una tienda para seleccionarla</p>\n                    </div>\n                    <div className=\"border border-gray-200 rounded-lg overflow-hidden\">\n                      <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-sm\">\n                          <thead className=\"bg-gray-50 border-b border-gray-200\">\n                            <tr>\n                              <th className=\"px-4 py-3 text-left font-semibold text-gray-700\">Tienda</th>\n                              <th className=\"px-4 py-3 text-left font-semibold text-gray-700\">Cami√≥n</th>\n                              <th className=\"px-4 py-3 text-center font-semibold text-gray-700\">Requerido</th>\n                              <th className=\"px-4 py-3 text-center font-semibold text-gray-700\">Confirmado</th>\n                              <th className=\"px-4 py-3 text-center font-semibold text-gray-700\">Pendiente</th>\n                              <th className=\"px-4 py-3 text-center font-semibold text-gray-700\">Estado</th>\n                            </tr>\n                          </thead>\n                          <tbody className=\"divide-y divide-gray-200\">\n                            {tiendasProgress.map((tienda) => {\n                              const isActive = tienda.tienda === selectedStore;\n                              const isClickable = tienda.pending > 0;\n\n                              return (\n                                <tr\n                                  key={tienda.tienda}\n                                  onClick={() => handleStoreClick(tienda)}\n                                  className={`transition-colors ${\n                                    isActive\n                                      ? 'bg-sky-50 ring-2 ring-inset ring-sky-400'\n                                      : isClickable\n                                      ? 'bg-white hover:bg-teal-50 cursor-pointer'\n                                      : 'bg-gray-50/50 opacity-60 cursor-not-allowed'\n                                  }`}\n                                  title={\n                                    isActive\n                                      ? 'Tienda activa'\n                                      : isClickable\n                                      ? `Seleccionar ${tienda.tienda}`\n                                      : 'Tienda ya completa'\n                                  }\n                                >\n                                  <td className=\"px-4 py-3\">\n                                    <div className=\"flex items-center\">\n                                      {isActive ? (\n                                        <i className=\"ri-checkbox-circle-fill text-sky-600 mr-2 text-base\"></i>\n                                      ) : isClickable ? (\n                                        <i className=\"ri-radio-button-line text-gray-300 mr-2 text-base\"></i>\n                                      ) : (\n                                        <i className=\"ri-checkbox-circle-fill text-emerald-400 mr-2 text-base\"></i>\n                                      )}\n                                      <span className={`font-medium ${isActive ? 'text-sky-700' : 'text-gray-900'}`}>\n                                        {tienda.tienda}\n                                      </span>\n                                      {isActive && (\n                                        <span className=\"ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-sky-600 text-white uppercase tracking-wide\">\n                                          Activa\n                                        </span>\n                                      )}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-4 py-3\">\n                                    {tienda.camion ? (\n                                      <span className=\"inline-flex items-center text-xs font-medium text-amber-700\">\n                                        <i className=\"ri-truck-line mr-1\"></i>\n                                        {tienda.camion}\n                                      </span>\n                                    ) : (\n                                      <span className=\"text-xs text-gray-400\">‚Äî</span>\n                                    )}\n                                  </td>\n                                  <td className=\"px-4 py-3 text-center text-gray-700\">{tienda.qty_to_send}</td>\n                                  <td className=\"px-4 py-3 text-center\">\n                                    <span className=\"font-semibold text-teal-600\">{tienda.qty_confirmed}</span>\n                                  </td>\n                                  <td className=\"px-4 py-3 text-center\">\n                                    <span\n                                      className={`font-semibold ${\n                                        tienda.pending > 0 ? 'text-amber-600' : 'text-emerald-600'\n                                      }`}\n                                    >\n                                      {tienda.pending}\n                                    </span>\n                                  </td>\n                                  <td className=\"px-4 py-3 text-center\">\n                                    <span\n                                      className={`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${\n                                        tienda.status === 'DONE'\n                                          ? 'bg-emerald-100 text-emerald-700'\n                                          : tienda.status === 'PARTIAL'\n                                          ? 'bg-amber-100 text-amber-700'\n                                          : 'bg-gray-100 text-gray-700'\n                                      }`}\n                                    >\n                                      {tienda.status === 'DONE' && <i className=\"ri-checkbox-circle-fill mr-1\"></i>}\n                                      {tienda.status === 'PARTIAL' && <i className=\"ri-time-line mr-1\"></i>}\n                                      {tienda.status === 'PENDING' && <i className=\"ri-hourglass-line mr-1\"></i>}\n                                      {tienda.status}\n                                    </span>\n                                  </td>\n                                </tr>\n                              );\n                            })}\n                          </tbody>\n                        </table>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"flex items-center space-x-4\">\n                  <button\n                    onClick={() => {\n                      setStep('scan');\n                      setSelectedSku('');\n                      setSelectedLine(null);\n                      setSelectedStore('');\n                      setManualStoreSelection(false);\n                      setQuantity('');\n                      setError('');\n                      previousTiendaRef.current = null;\n                    }}\n                    className=\"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer\"\n                  >\n                    Cancelar\n                  </button>\n                  <button\n                    onClick={handleConfirm}\n                    disabled={isConfirmDisabled}\n                    className=\"flex-1 px-6 py-3 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-lg font-medium hover:from-teal-600 hover:to-cyan-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer\"\n                  >\n                    Confirmar\n                  </button>\n                </div>\n              </div>\n            )}\n\n            <div className=\"mt-8 pt-6 border-t border-gray-200\">\n              <button\n                onClick={handleOpenCloseModal}\n                disabled={isCloseDisabled}\n                className=\"w-full px-6 py-3 bg-gradient-to-r from-rose-500 to-rose-600 text-white rounded-lg font-medium hover:from-rose-600 hover:to-rose-700 transition-all whitespace-nowrap cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <i className=\"ri-inbox-line mr-2\"></i>\n                Cerrar Distribuci√≥n (Generar Licencia)\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {showScanner && <QRScanner onScan={handleSkuScan} onClose={() => setShowScanner(false)} />}\n      </div>\n\n      {/* Modal de cierre de distribuci√≥n */}\n      {showCloseModal && (\n        <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60] p-4\">\n          <div className=\"bg-white rounded-xl shadow-2xl max-w-md w-full\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-xl font-bold text-gray-900\">Cerrar Distribuci√≥n</h3>\n                <button\n                  onClick={() => {\n                    setShowCloseModal(false);\n                    setSelectedTiendaToClose('');\n                  }}\n                  className=\"text-gray-400 hover:text-gray-600 cursor-pointer\"\n                  disabled={closingInProgress}\n                >\n                  <i className=\"ri-close-line text-2xl\"></i>\n                </button>\n              </div>\n            </div>\n\n            <div className=\"p-6\">\n              <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6\">\n                <div className=\"flex items-start\">\n                  <i className=\"ri-alert-line text-amber-600 text-xl mr-3 mt-0.5\"></i>\n                  <div>\n                    <p className=\"text-sm font-medium text-amber-900 mb-1\">Importante</p>\n                    <p className=\"text-sm text-amber-700\">\n                      Al cerrar la distribuci√≥n, el contenedor cambiar√° a estado CLOSED y no se podr√°n agregar m√°s l√≠neas.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"mb-6\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Selecciona la tienda</label>\n                <select\n                  value={selectedTiendaToClose}\n                  onChange={(e) => setSelectedTiendaToClose(e.target.value)}\n                  onFocus={loadAvailableTiendas}\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent text-sm cursor-pointer\"\n                  disabled={closingInProgress}\n                >\n                  <option value=\"\">-- Seleccionar tienda --</option>\n                  {availableTiendas.map((tienda) => (\n                    <option key={tienda} value={tienda}>\n                      {tienda}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"flex items-center space-x-4\">\n                <button\n                  onClick={() => {\n                    setShowCloseModal(false);\n                    setSelectedTiendaToClose('');\n                  }}\n                  disabled={closingInProgress}\n                  className=\"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Cancelar\n                </button>\n                <button\n                  onClick={handleCerrarDistribucion}\n                  disabled={!selectedTiendaToClose || closingInProgress}\n                  className=\"flex-1 px-6 py-3 bg-gradient-to-r from-rose-500 to-rose-600 text-white rounded-lg font-medium hover:from-rose-600 hover:to-rose-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer\"\n                >\n                  {closingInProgress ? (\n                    <>\n                      <i className=\"ri-loader-4-line mr-2 animate-spin\"></i>\n                      Cerrando...\n                    </>\n                  ) : (\n                    <>\n                      <i className=\"ri-check-line mr-2\"></i>\n                      Confirmar Cierre\n                    </>\n                  )}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Popup informativo de cambio de tienda */}\n      {tiendaChange && (\n        <TiendaChangePopup\n          previousTienda={tiendaChange.prev}\n          newTienda={tiendaChange.next}\n          sku={tiendaChange.sku}\n          onClose={() => setTiendaChange(null)}\n        />\n      )}\n    </>\n  );\n}\n","\nimport React, { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { supabase, Pallet, PalletInventory, ImportLine } from '../../lib/supabase';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { useToast } from '../../components/base/Toast';\nimport DistribucionModal from './components/DistribucionModal';\nimport QRScanner from '../../components/scanner/QRScanner';\n\nexport default function OperacionPage() {\n  const { user } = useAuth();\n  const { showToast } = useToast();\n  const [showScanner, setShowScanner] = useState(false);\n  const [selectedPallet, setSelectedPallet] = useState<Pallet | null>(null);\n  const [palletInventory, setPalletInventory] = useState<PalletInventory[]>([]);\n  const [pendingLines, setPendingLines] = useState<ImportLine[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [showDistribucion, setShowDistribucion] = useState(false);\n\n  const handleScan = async (code: string) => {\n    setLoading(true);\n    setShowScanner(false);\n\n    try {\n      const { data: pallet, error: palletError } = await supabase\n        .from('pallets')\n        .select('*')\n        .eq('pallet_code', code)\n        .maybeSingle();\n\n      if (palletError) throw palletError;\n\n      if (!pallet) {\n        showToast(\n          'error',\n          'Pallet no encontrado',\n          'El c√≥digo escaneado no corresponde a ning√∫n pallet registrado'\n        );\n        return;\n      }\n\n      if (pallet.status === 'BLOCKED') {\n        showToast('warning', 'Pallet bloqueado', 'Este pallet est√° bloqueado y no puede ser utilizado');\n        return;\n      }\n\n      if (pallet.locked_by && pallet.locked_by !== user?.id) {\n        showToast('warning', 'Pallet en uso', 'Este pallet est√° siendo usado por otro usuario');\n        return;\n      }\n\n      await supabase\n        .from('pallets')\n        .update({ locked_by: user?.id, locked_at: new Date().toISOString() })\n        .eq('id', pallet.id);\n\n      await supabase.from('scan_events').insert({\n        pallet_id: pallet.id,\n        event_type: 'SCAN_PALLET',\n        raw_code: code,\n        user_id: user?.id,\n      });\n\n      const { data: inventory } = await supabase\n        .from('pallet_inventory')\n        .select('*')\n        .eq('pallet_id', pallet.id)\n        .gt('qty_available', 0);\n\n      const { data: lines } = await supabase\n        .from('import_lines')\n        .select('*')\n        .eq('pallet_code', pallet.pallet_code)\n        .in('status', ['PENDING', 'PARTIAL']);\n\n      setSelectedPallet(pallet);\n      setPalletInventory(inventory ?? []);\n      setPendingLines(lines ?? []);\n    } catch (error: any) {\n      console.error('Error escaneando pallet:', error);\n      showToast('error', 'Error al escanear', 'No se pudo procesar el c√≥digo escaneado');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleUnlock = async () => {\n    if (!selectedPallet) return;\n\n    try {\n      await supabase\n        .from('pallets')\n        .update({ locked_by: null, locked_at: null })\n        .eq('id', selectedPallet.id);\n\n      await supabase.from('scan_events').insert({\n        pallet_id: selectedPallet.id,\n        event_type: 'UNLOCK',\n        user_id: user?.id,\n      });\n\n      setSelectedPallet(null);\n      setPalletInventory([]);\n      setPendingLines([]);\n    } catch (error: any) {\n      console.error('Error desbloqueando pallet:', error);\n      showToast('error', 'Error', 'No se pudo liberar el pallet');\n    }\n  };\n\n  const refreshData = async () => {\n    if (!selectedPallet) return;\n\n    try {\n      const { data: inventory } = await supabase\n        .from('pallet_inventory')\n        .select('*')\n        .eq('pallet_id', selectedPallet.id)\n        .gt('qty_available', 0);\n\n      const { data: lines } = await supabase\n        .from('import_lines')\n        .select('*')\n        .eq('pallet_code', selectedPallet.pallet_code)\n        .in('status', ['PENDING', 'PARTIAL']);\n\n      setPalletInventory(inventory ?? []);\n      setPendingLines(lines ?? []);\n    } catch (error: any) {\n      console.error('Error refrescando datos del pallet:', error);\n      showToast('error', 'Error', 'No se pudo actualizar la informaci√≥n del pallet');\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">Operaci√≥n de Distribuci√≥n</h2>\n          <p className=\"text-sm text-gray-500 mt-1\">\n            Escanea pallets y distribuye productos a tiendas\n          </p>\n        </div>\n        <Link\n          to=\"/operacion/reportes\"\n          className=\"px-4 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer inline-flex items-center\"\n        >\n          <i className=\"ri-file-chart-line mr-2\"></i>\n          Ver Reportes\n        </Link>\n      </div>\n\n      {!selectedPallet ? (\n        <div className=\"bg-white rounded-xl border border-gray-100 p-12 text-center\">\n          <div className=\"w-20 h-20 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-2xl flex items-center justify-center mx-auto mb-6\">\n            <i className=\"ri-qr-scan-2-line text-4xl text-white\"></i>\n          </div>\n          <h2 className=\"text-xl font-bold text-gray-900 mb-3\">Escanear Pallet</h2>\n          <p className=\"text-sm text-gray-500 mb-8\">\n            Escanea el c√≥digo QR del pallet para iniciar la distribuci√≥n\n          </p>\n          <button\n            onClick={() => setShowScanner(true)}\n            className=\"px-8 py-3.5 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-lg font-medium hover:from-teal-600 hover:to-cyan-700 transition-all text-sm whitespace-nowrap cursor-pointer\"\n          >\n            <i className=\"ri-camera-line mr-2\"></i>\n            Activar C√°mara\n          </button>\n        </div>\n      ) : (\n        <div className=\"space-y-6\">\n          <div className=\"bg-white rounded-xl border border-gray-100 p-5\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div>\n                <h2 className=\"text-xl font-bold text-gray-900\">{selectedPallet.pallet_code}</h2>\n                <p className=\"text-sm text-gray-500\">Ubicaci√≥n: {selectedPallet.ubicacion}</p>\n              </div>\n              <button\n                onClick={handleUnlock}\n                className=\"px-4 py-2 border border-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer\"\n              >\n                <i className=\"ri-lock-unlock-line mr-2\"></i>\n                Liberar Pallet\n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <h3 className=\"text-sm font-semibold text-gray-900 mb-3\">\n                  Inventario Disponible\n                </h3>\n                <div className=\"space-y-2\">\n                  {palletInventory.map((inv) => (\n                    <div key={inv.id} className=\"border border-gray-100 rounded-lg p-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-sm font-medium text-gray-900\">{inv.sku}</span>\n                        <span className=\"text-base font-bold text-teal-600\">\n                          {inv.qty_available}\n                        </span>\n                      </div>\n                      <div className=\"text-xs text-gray-500 mt-0.5\">\n                        Inicial: {inv.qty_initial}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-semibold text-gray-900 mb-3\">\n                  Pedidos Pendientes\n                </h3>\n                <div className=\"space-y-2\">\n                  {pendingLines.map((line) => (\n                    <div key={line.id} className=\"border border-gray-100 rounded-lg p-3\">\n                      <div className=\"flex items-center justify-between mb-1\">\n                        <span className=\"text-sm font-medium text-gray-900\">{line.sku}</span>\n                        <div className=\"flex items-center gap-2\">\n                          {line.camion && (\n                            <span className=\"text-xs font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full inline-flex items-center\">\n                              <i className=\"ri-truck-line mr-1\"></i>\n                              {line.camion}\n                            </span>\n                          )}\n                          <span className=\"text-xs font-medium text-sky-600 bg-sky-50 px-2 py-0.5 rounded-full\">\n                            {line.tienda}\n                          </span>\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-gray-500\">\n                        Pendiente: {line.qty_to_send - line.qty_confirmed} / {line.qty_to_send}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"mt-6 pt-5 border-t border-gray-100\">\n              <button\n                onClick={() => setShowDistribucion(true)}\n                disabled={palletInventory.length === 0 || pendingLines.length === 0}\n                className=\"w-full px-6 py-3.5 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-lg font-medium hover:from-teal-600 hover:to-cyan-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm whitespace-nowrap cursor-pointer\"\n              >\n                <i className=\"ri-box-3-line mr-2\"></i>\n                Iniciar Distribuci√≥n\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showScanner && (\n        <QRScanner onScan={handleScan} onClose={() => setShowScanner(false)} />\n      )}\n\n      {showDistribucion && selectedPallet && (\n        <DistribucionModal\n          pallet={selectedPallet}\n          inventory={palletInventory}\n          pendingLines={pendingLines}\n          onClose={() => {\n            setShowDistribucion(false);\n            refreshData();\n          }}\n          onComplete={() => {\n            setShowDistribucion(false);\n            handleUnlock();\n          }}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["generateContainerCode","lastContainer","supabase","nextNumber","getOrCreateOpenContainer","importId","tienda","userId","attempt","existingContainer","code","newContainer","insertError","error","resolve","isContainerEditable","containerId","container","QRScanner","onScan","onClose","videoRef","useRef","manualCode","setManualCode","useState","setError","useEffect","startCamera","stopCamera","stream","err","track","handleManualSubmit","e","jsxs","jsx","TiendaChangePopup","previousTienda","newTienda","sku","isVisible","setIsVisible","handleClose","DistribucionModal","pallet","inventory","pendingLines","onComplete","user","authLoading","useAuth","showToast","useToast","step","setStep","showScanner","setShowScanner","selectedSku","setSelectedSku","selectedLine","setSelectedLine","quantity","setQuantity","showCloseModal","setShowCloseModal","selectedTiendaToClose","setSelectedTiendaToClose","closingInProgress","setClosingInProgress","availableTiendas","setAvailableTiendas","selectedStore","setSelectedStore","manualStoreSelection","setManualStoreSelection","skuProgress","setSkuProgress","tiendasProgress","setTiendasProgress","skuLinesCache","setSkuLinesCache","tiendaChange","setTiendaChange","previousTiendaRef","hasUser","loadSkuProgress","lines","total","sum","l","confirmed","percentage","tiendas","line","getNextPendingLine","handleStoreClick","prevStore","handleBackToAuto","nextLine","handleSkuScan","resolvedSku","inv","i","lineByBarcode","currentInv","allLines","defaultLine","handleConfirm","qty","pending","invError","newConfirmed","newStatus","lineError","containerLineError","moveError","currentStorePending","updatedInv","hasInventory","prevTienda","allInv","handleOpenCloseModal","openContainers","c","handleCerrarDistribucion","openContainer","count","updateError","loadAvailableTiendas","currentPending","isConfirmDisabled","isCloseDisabled","Fragment","isActive","isClickable","OperacionPage","selectedPallet","setSelectedPallet","palletInventory","setPalletInventory","setPendingLines","loading","setLoading","showDistribucion","setShowDistribucion","handleScan","palletError","handleUnlock","refreshData","Link"],"mappings":"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"}